(function(e){function t(t){for(var a,r,o=t[0],l=t[1],c=t[2],d=0,m=[];d<o.length;d++)r=o[d],i[r]&&m.push(i[r][0]),i[r]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);u&&u(t);while(m.length)m.shift()();return n.push.apply(n,c||[]),s()}function s(){for(var e,t=0;t<n.length;t++){for(var s=n[t],a=!0,o=1;o<s.length;o++){var l=s[o];0!==i[l]&&(a=!1)}a&&(n.splice(t--,1),e=r(r.s=s[0]))}return e}var a={},i={app:0},n=[];function r(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=a,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(s,a,function(t){return e[t]}.bind(null,a));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;n.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"11ed":function(e,t,s){"use strict";var a=s("c62e"),i=s.n(a);i.a},"29d8":function(e,t,s){},4678:function(e,t,s){var a={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-SG":"cdab","./en-SG.js":"cdab","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-nz":"6f50","./en-nz.js":"6f50","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-tw":"90ea","./zh-tw.js":"90ea"};function i(e){var t=n(e);return s(t)}function n(e){var t=a[e];if(!(t+1)){var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}return t}i.keys=function(){return Object.keys(a)},i.resolve=n,e.exports=i,i.id="4678"},"56d7":function(e,t,s){"use strict";s.r(t);s("cadf"),s("551c"),s("f751"),s("097d");var a=s("2b0e"),i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("layout",[s("keep-alive",{attrs:{exclude:["TableForm","UserForm","ReserveForm","TablePresetForDateForm","TablePresetForm","Booking"]}},[s("router-view")],1)],1)],1)},n=[],r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"layout"},[s("div",{staticClass:"layout__content"},[s("div",{staticClass:"main"},[e.isIn?s("sidebar"):e._e(),s("div",{staticClass:"content",class:{wide:e.sidebarMinimized}},[e._t("default")],2)],1)])])},o=[],l=(s("8e6e"),s("ac6a"),s("456d"),s("7f7f"),s("bd86")),c=s("2f62"),u=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"sidebar-wrapper"},[s("div",{staticClass:"sidebar",class:{mini:e.sidebarMinimized}},[s("div",{staticClass:"sidebar__toggle",on:{click:e.toggleSidebar}},[s("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"14",viewBox:"0 0 16 14"}},[s("g",[s("g",[s("g",[s("path",{staticClass:"stroke",attrs:{fill:"none","stroke-miterlimit":"50","stroke-width":"2",d:"M0 1h16"}})]),s("g",[s("path",{staticClass:"stroke",attrs:{fill:"none","stroke-miterlimit":"50","stroke-width":"2",d:"M0 7h16"}})]),s("g",[s("path",{staticClass:"stroke",attrs:{fill:"none","stroke-miterlimit":"50","stroke-width":"2",d:"M0 13h16"}})])])])])]),s("div",{staticClass:"sidebar__logo",on:{click:e.toMain}},[s("span",{staticClass:"sidebar__item-text"},[e._v("QUEEN")])]),s("nav",{staticClass:"sidebar__nav"},[s("div",{staticClass:"sidebar__list"},[s("router-link",{staticClass:"sidebar__item",attrs:{to:"/booking"}},[s("span",{staticClass:"sidebar__item-content"},[s("i",{staticClass:"fas fa-pen-fancy"}),s("span",{staticClass:"sidebar__item-text"},[e._v("Букинг")])])]),s("router-link",{staticClass:"sidebar__item",attrs:{to:"/tables"}},[s("span",{staticClass:"sidebar__item-content"},[s("i",{staticClass:"fas fa-layer-group"}),s("span",{staticClass:"sidebar__item-text"},[e._v("Столы")])])]),s("router-link",{staticClass:"sidebar__item",attrs:{to:"/events"}},[s("span",{staticClass:"sidebar__item-content"},[s("i",{staticClass:"fas fa-calendar-alt"}),s("span",{staticClass:"sidebar__item-text"},[e._v("События")])])]),s("router-link",{staticClass:"sidebar__item",attrs:{to:"/reserves"}},[s("span",{staticClass:"sidebar__item-content"},[s("i",{staticClass:"fas fa-clipboard-list"}),s("span",{staticClass:"sidebar__item-text"},[e._v("Резервы")])])]),s("router-link",{staticClass:"sidebar__item",attrs:{to:"/reserves-from-app"}},[s("span",{staticClass:"sidebar__item-content"},[s("i",{staticClass:"fa fa-mobile"},[parseFloat(e.reservesFromAppCounter)>0?s("span",{staticClass:"sidebar__item-counter"},[e._v(e._s(e.reservesFromAppCounter))]):e._e()]),s("span",{staticClass:"sidebar__item-text sidebar__item-text_two-lines"},[e._v("Резервы из приложения")])])]),s("router-link",{staticClass:"sidebar__item",attrs:{to:"/table-presets"}},[s("span",{staticClass:"sidebar__item-content"},[s("i",{staticClass:"fas fa-chess-board"}),s("span",{staticClass:"sidebar__item-text"},[e._v("Расстановки")])]),s("router-link",{staticClass:"sidebar__item sidebar__item_nested",attrs:{to:"/table-presets/saved"}},[s("span",{staticClass:"sidebar__item-content sidebar__item-content_nested"},[s("i",{staticClass:"far fa-save"}),s("span",{staticClass:"sidebar__item-text"},[e._v("Сохраненные")])])]),s("router-link",{staticClass:"sidebar__item sidebar__item_nested",attrs:{to:"/table-presets/on-date"}},[s("span",{staticClass:"sidebar__item-content sidebar__item-content_nested"},[s("i",{staticClass:"fas fa-list-ol"}),s("span",{staticClass:"sidebar__item-text"},[e._v("По датам")])])])],1),s("a",{staticClass:"sidebar__item sidebar__item_special",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.logout(t)}}},[e._m(0)])],1)])])])},d=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",{staticClass:"sidebar__item-content"},[s("i",{staticClass:"fas fa-sign-out-alt"}),s("span",{staticClass:"sidebar__item-text"},[e._v("Выйти")])])}];function m(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,a)}return s}function p(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?m(s,!0).forEach(function(t){Object(l["a"])(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):m(s).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}var b={name:"Sidebar",computed:p({},Object(c["c"])(["sidebarMinimized"]),{},Object(c["b"])(["reservesFromAppCounter"])),methods:{toMain:function(){this.$router.push("/")},toggleSidebar:function(){this.$store.dispatch("toggleSidebar")},logout:function(){var e=this;this.$store.dispatch("logout").then(function(){e.$router.push("/login")})},updateReservesFromApp:function(){this.$store.dispatch("getReservesFromApp")}},mounted:function(){this.updateReservesFromApp(),setInterval(this.updateReservesFromApp,6e4)}},h=b,v=s("2877"),_=Object(v["a"])(h,u,d,!1,null,null,null),f=_.exports;function g(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,a)}return s}function j(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?g(s,!0).forEach(function(t){Object(l["a"])(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):g(s).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}var C={name:"layout",components:{Sidebar:f},data:function(){return{}},computed:j({isIn:function(){return"Login"!==this.$route.name}},Object(c["c"])(["user","sidebarMinimized"]),{},Object(c["b"])(["isLoggedIn"])),methods:{logout:function(){this.$store.dispatch("logout")}}},O=C,y=Object(v["a"])(O,r,o,!1,null,null,null),w=y.exports,T={name:"app",components:{Layout:w},computed:{},methods:{},mounted:function(){}},k=T,S=(s("60bc"),Object(v["a"])(k,i,n,!1,null,null,null)),x=S.exports,P=s("8c4f"),D=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login"},[s("div",{staticClass:"login__content"},[s("h2",{staticClass:"login__title"},[e._v("Авторизоваться")]),s("h5",{staticClass:"login__subtitle"},[e._v("Пожалуйста, заполните следующие поля для входа:")]),s("form",{staticClass:"login-form",on:{submit:function(t){return t.preventDefault(),e.login(t)}}},[s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"email"}},[e._v("Email")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],ref:"email",attrs:{id:"email",type:"text",required:""},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"password"}},[e._v("Password")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],ref:"password",attrs:{id:"password",type:"password",required:""},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})])]),s("div",{staticClass:"site-input site-input_check"},[s("label",{attrs:{for:"remember"}},[e._v("Remember me")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.rememberMe,expression:"rememberMe"}],ref:"rememberMe",attrs:{id:"remember",type:"checkbox",required:""},domProps:{checked:Array.isArray(e.rememberMe)?e._i(e.rememberMe,null)>-1:e.rememberMe},on:{change:function(t){var s=e.rememberMe,a=t.target,i=!!a.checked;if(Array.isArray(s)){var n=null,r=e._i(s,n);a.checked?r<0&&(e.rememberMe=s.concat([n])):r>-1&&(e.rememberMe=s.slice(0,r).concat(s.slice(r+1)))}else e.rememberMe=i}}})]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.showError,expression:"showError"}],staticClass:"login__error"},[s("span",[e._v(" Введен неверный логин или пароль")])]),s("button",{staticClass:"btn",attrs:{type:"submit"}},[e._v("Авторизоваться")])]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.error,expression:"error"}],staticClass:"login-error"},[e._v(e._s(e.error))])])])},M=[],E={name:"Login",data:function(){return{email:"",password:"",rememberMe:!0,error:"",showError:!1}},watch:{},methods:{login:function(){var e=this,t=this.email,s=this.password,a=this.rememberMe;this.$store.dispatch("login",{user:{email:t,password:s},rememberMe:a}).then(function(){e.$router.push("/booking")}).catch(function(){e.showError=!0})},goTo:function(e){this.$router.push("/"+e)}}},F=E,I=Object(v["a"])(F,D,M,!1,null,null,null),R=I.exports,L=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},A=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"section main"},[s("h2",{staticClass:"section__title"},[e._v("Welcome ;)")])])}],Y={name:"Main",components:{}},N=Y,B=Object(v["a"])(N,L,A,!1,null,null,null),H=B.exports,U=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"section table-presets"},[s("h2",{staticClass:"section__title"},[e._v("Расстановки столов: сохраненные")]),s("div",{staticClass:"section__create-btn"},[s("router-link",{attrs:{to:"/table-presets/create/"}},[s("button",{staticClass:"btn btn_success"},[e._v("Создать расстановку")])])],1),s("data-table",{ref:"table",attrs:{options:e.tableOptions}})],1)},z=[],q=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",["reserve"===e.options.type?s("div",{staticClass:"reserve__top"},[s("div",{staticClass:"site-input reserve__select"},[s("label",{attrs:{for:"past_reserve"}},[e._v("Период резервов")]),s("div",{staticClass:"input-item",attrs:{id:"past_reserve"}},[s("multiselect",{attrs:{options:e.reserveOptions,"close-on-select":!0,searchable:!1,"clear-on-select":!0,placeholder:"Выберите период резервов...",multiple:!1,selectLabel:"Выбрать",deselectLabel:"Убрать",selectedLabel:"Выбрано"},model:{value:e.selectedReserveOptions,callback:function(t){e.selectedReserveOptions=t},expression:"selectedReserveOptions"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("По вашему запросу нет результатов.")])])],1)]),s("div",{staticClass:"reserve__order"},[e._v(" Сортировка:\n            "),s("span",{class:{reserve__active:"created_at"===e.options.getDataParams.orderBy},on:{click:function(t){return e.changeOrderBy("created_at")}}},[e._v(" Создан")]),s("span",{class:{reserve__active:"date_start"===e.options.getDataParams.orderBy},on:{click:function(t){return e.changeOrderBy("date_start")}}},[e._v(" Дата начала")])])]):e._e(),s("div",{staticClass:"table-container"},[s("v-client-table",{ref:"table",attrs:{data:e.tableData,columns:e.columns,options:e.tableOptions},scopedSlots:e._u([{key:"prependBody",fn:function(){return[s("tr",e._l(e.columns,function(t,a){return s("td",{key:a},[void 0!==e.searchObject[t]?s("input",{staticClass:"table__search form-control",attrs:{type:"text"},domProps:{value:e.searchObject[t]},on:{input:function(s){return e.debounceSearch(s.target.value,t)}}}):e._e()])}),0)]},proxy:!0},{key:"edit",fn:function(t){var a=t.row;return s("div",{staticClass:"table__controls"},[e.actions.includes("view")?s("a",{staticClass:"table__controls-btn",attrs:{title:"Просмотр"},on:{click:function(t){return t.preventDefault(),e.showItem(a)}}},[s("i",{staticClass:"fas fa-eye"})]):e._e(),e.actions.includes("edit")?s("a",{staticClass:"table__controls-btn",attrs:{title:"Редактировать"},on:{click:function(t){return t.preventDefault(),e.editItem(a,"edit")}}},[s("i",{staticClass:"far fa-edit"})]):e._e(),e.actions.includes("delete")?s("a",{staticClass:"table__controls-btn",attrs:{title:"Удалить"},on:{click:function(t){return t.preventDefault(),e.deleteItem(a)}}},[s("i",{staticClass:"far fa-trash-alt"})]):e._e(),e.actions.includes("copy")?s("a",{staticClass:"table__controls-btn",attrs:{title:"Копировать"},on:{click:function(t){return t.preventDefault(),e.editItem(a,"copy")}}},[s("i",{staticClass:"fa fa-clone",attrs:{"aria-hidden":"true"}})]):e._e()])}}])}),s("pagination",{attrs:{records:e.pagination.records,options:e.paginationOptions,perPage:e.pagination.perPage},on:{paginate:e.paginate},model:{value:e.pagination.page,callback:function(t){e.$set(e.pagination,"page",t)},expression:"pagination.page"}})],1),s("item-view-modal",{attrs:{showItemPopup:e.showItemPopup,rows:e.columns,headings:e.tableOptions.headings,close:e.closeItemPopup,itemToShow:e.itemToShow,viewType:e.viewType,editItem:e.editItem,deleteItem:e.deleteItem}}),e.showItemEditPopup?s("div",{staticClass:"modal",class:{fade:!e.showItemEditPopup,open:e.showItemEditPopup,fullscreen:"tablePreset"===e.options.type||"tablesForDate"===e.options.type},on:{click:function(t){if(t.target!==t.currentTarget)return null;t.stopPropagation(),e.showItemEditPopup=!1}}},[s("div",{staticClass:"modal-dialog modal-lg"},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"popup__main-controls"},[s("div",{staticClass:"popup__control popup__control_save",class:{disabled:!e.itemIsChanged},on:{click:function(t){return e.submitForm(e.itemToEdit)}}},[s("span",[e._v("✔")])]),s("div",{staticClass:"popup__control popup__control_close",on:{click:e.closeItemEditPopup}},[s("span",[e._v("×")])])]),s("div",{staticClass:"modal-body"},[s("div",{staticClass:"modal modal__main-info",class:{fade:!e.confirmClose,open:e.confirmClose},on:{click:function(t){if(t.target!==t.currentTarget)return null;t.stopPropagation(),e.showItemDeletePopup=!1}}},[s("div",{staticClass:"modal-dialog modal-md"},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-body"},[s("h4",[e._v("Были внесены изменения, вы точно хотите закрыть форму?")]),s("div",{staticClass:"popup__buttons popup__buttons_spread popup__buttons_mt"},[s("button",{staticClass:"btn btn_primary",on:{click:function(t){return t.preventDefault(),e.closeItemEditPopupCancel(t)}}},[e._v("Отмена")]),s("button",{staticClass:"btn btn_danger",on:{click:function(t){return t.preventDefault(),e.closeItemEditPopupConfirme(t)}}},[e._v("Закрыть без сохранения ")])])])])])]),"user"===e.options.type?s("user-form",{attrs:{type:"edit",user:e.itemToEdit},on:{userSubmitSuccess:e.onItemEditSuccess,itemChanged:e.onItemChanged}}):e._e(),"table"===e.options.type?s("table-form",{attrs:{type:"edit",item:e.itemToEdit},on:{itemSubmitSuccess:e.onItemEditSuccess,itemChanged:e.onItemChanged}}):e._e(),"event"===e.options.type?s("event-form",{attrs:{type:"edit",event:e.itemToEdit},on:{itemSubmitSuccess:e.onItemEditSuccess,itemChanged:e.onItemChanged}}):e._e(),"reserve"===e.options.type?s("reserve-form",{attrs:{type:e.typeForm?"create":"edit",reserve:e.itemToEdit},on:{itemSubmitSuccess:e.onItemEditSuccess,itemChanged:e.onItemChanged}}):e._e(),"reserveFromApp"===e.options.type?s("reserve-from-app-form",{attrs:{type:e.typeForm?"create":"edit",reserve:e.itemToEdit},on:{itemSubmitSuccess:e.onItemEditSuccess,itemChanged:e.onItemChanged}}):e._e(),"tablePreset"===e.options.type?s("table-preset-form",{attrs:{type:e.typeForm?"create":"edit",tablePreset:e.itemToEdit},on:{itemSubmitSuccess:e.onItemEditSuccess,itemChanged:e.onItemChanged}}):e._e(),"tablesForDate"===e.options.type?s("table-preset-for-date-form",{attrs:{type:e.typeForm?"create":"edit",tablePreset:e.itemToEdit},on:{itemSubmitSuccess:e.onItemEditSuccess,itemChanged:e.onItemChanged}}):e._e()],1)])])]):e._e(),s("div",{staticClass:"modal",class:{fade:!e.showItemDeletePopup,open:e.showItemDeletePopup},on:{click:function(t){if(t.target!==t.currentTarget)return null;t.stopPropagation(),e.showItemDeletePopup=!1}}},[s("div",{staticClass:"modal-dialog modal-md"},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-body"},[s("div",{staticClass:"popup__close",on:{click:function(t){e.showItemDeletePopup=!1}}},[e._v("×")]),s("h4",[e._v("Удалить "+e._s(e.itemToDelete.id)+"?")]),"reserve"===e.options.type?s("div",{staticClass:"site-input popup__reason"},[s("label",{attrs:{for:"reason_remove"}},[e._v("Укажите причину удаления:")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.reasonForRemoval,expression:"reasonForRemoval"}],attrs:{id:"reason_remove",type:"text"},domProps:{value:e.reasonForRemoval},on:{input:function(t){t.target.composing||(e.reasonForRemoval=t.target.value)}}})])]):e._e(),s("div",{staticClass:"popup__buttons popup__buttons_spread popup__buttons_mt"},[s("button",{staticClass:"btn btn_primary",on:{click:function(t){t.preventDefault(),e.showItemDeletePopup=!1}}},[e._v("Отмена")]),"reserve"===e.options.type?s("button",{staticClass:"btn btn_danger",attrs:{disabled:!e.reasonForRemoval},on:{click:function(t){return t.preventDefault(),e.deleteConfirmed(e.itemToDelete)}}},[e._v("Удалить")]):s("button",{staticClass:"btn btn_danger",on:{click:function(t){return t.preventDefault(),e.deleteConfirmed(e.itemToDelete)}}},[e._v("Удалить")])])])])])])],1)},V=[],X=(s("7514"),s("5df3"),{production:"http://queen.bigdig.com.ua/api",development:"http://queen.bigdig.com.ua/api"}),Q={baseURL:X["production"]||X.development,login:"/login",user:"/users",client:"/clients",event:"/events",reserve:"/reserves",restaurant:"/restaurants",restaurantSpace:"/restaurant_spaces",table:"/tables",tableGroup:"/tableGroups",tablePreset:"/table_presets",tablesForDate:"/tables_for_date",booking:"/booking",reserveFromApp:"/reserves"},W={user:{local:"user"},token:{param:"api_token",local:"_x-_"},sidebarMinimized:{local:"_sbm_"}},G=s("ef30"),Z=s.n(G),J=s("8e5f"),K=s.n(J),ee=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",["create"===e.type?s("h2",{staticClass:"section__title"},[e._v("Создать пользователя")]):e._e(),"edit"===e.type?s("h2",{staticClass:"modal__title"},[e._v("Редактировать пользователя: "+e._s(e.userObj.username))]):e._e(),s("div",{staticClass:"new-user"},[s("form",{ref:"form",staticClass:"form",on:{submit:function(t){return t.preventDefault(),e.submitUser(t)}}},[s("div",{staticClass:"form__col"},[s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"username"}},[e._v("Имя пользователя")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.userObj.username,expression:"userObj.username"}],attrs:{id:"username",type:"text",required:""},domProps:{value:e.userObj.username},on:{input:function(t){t.target.composing||e.$set(e.userObj,"username",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"last_name"}},[e._v("Фамилия")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.userObj.last_name,expression:"userObj.last_name"}],attrs:{id:"last_name",type:"text"},domProps:{value:e.userObj.last_name},on:{input:function(t){t.target.composing||e.$set(e.userObj,"last_name",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"email"}},[e._v("Email")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.userObj.email,expression:"userObj.email"}],attrs:{id:"email",type:"text"},domProps:{value:e.userObj.email},on:{input:function(t){t.target.composing||e.$set(e.userObj,"email",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"status"}},[e._v("Статус")]),s("div",{staticClass:"input-item"},[s("select",{directives:[{name:"model",rawName:"v-model",value:e.userObj.status,expression:"userObj.status"}],attrs:{name:"status",id:"status"},on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){var t="_value"in e?e._value:e.value;return t});e.$set(e.userObj,"status",t.target.multiple?s:s[0])}}},e._l(e.availableStatuses,function(t,a){return s("option",{key:a,domProps:{value:t.value}},[e._v(e._s(t.label))])}),0)])])]),s("div",{staticClass:"form__col"},["create"===e.type?s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"password"}},[e._v("Пароль")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.userObj.password,expression:"userObj.password"}],attrs:{id:"password",type:"password",minlength:"6"},domProps:{value:e.userObj.password},on:{input:function(t){t.target.composing||e.$set(e.userObj,"password",t.target.value)}}})])]):e._e(),s("div",{staticClass:"site-input site-input_mb"},[s("label",{attrs:{for:"roles"}},[e._v("Роли")]),s("div",{staticClass:"input-item",attrs:{id:"roles"}},[s("multiselect",{attrs:{options:e.availableRoles,searchable:!1,"close-on-select":!1,placeholder:"Выберите роли",multiple:!0,trackBy:"value",label:"label",selectLabel:"Выбрать",deselectLabel:"Убрать",selectedLabel:"Выбрано"},model:{value:e.userObj.roles,callback:function(t){e.$set(e.userObj,"roles",t)},expression:"userObj.roles"}})],1)]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"birthday"}},[e._v("День рождения")]),s("div",{staticClass:"input-item"},[s("datepicker",{attrs:{id:"birthday",lang:"ru",type:"date",appendToBody:!1,format:"YYYY-MM-DD","first-day-of-week":1,width:"auto",valueType:"format"},model:{value:e.userObj.birthday,callback:function(t){e.$set(e.userObj,"birthday",t)},expression:"userObj.birthday"}})],1)]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"phone"}},[e._v("Телефон")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.userObj.phone,expression:"userObj.phone"}],attrs:{id:"phone",type:"text",required:""},domProps:{value:e.userObj.phone},on:{input:function(t){t.target.composing||e.$set(e.userObj,"phone",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"additional_info"}},[e._v("Дополнительная информация")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.userObj.additional_info,expression:"userObj.additional_info"}],attrs:{id:"additional_info",type:"text"},domProps:{value:e.userObj.additional_info},on:{input:function(t){t.target.composing||e.$set(e.userObj,"additional_info",t.target.value)}}})])])]),s("div",{staticClass:"form__row"},[s("div",{staticClass:"dropzone"},[s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"picture"}},[e._v("Изображение")]),e.show?e._e():s("p",[e._v("Перетащите сюда или выберите изображение "),s("i",{staticClass:"fa fa-cloud-upload"})]),s("input",{ref:"file",staticClass:"file-input",attrs:{type:"file",id:"picture",accept:"image/*"},on:{change:e.previewImage}})]),e.show?s("div",{staticClass:"image"},[s("img",{attrs:{src:e.imageData,alt:""}}),s("span",{staticClass:"close",on:{click:e.deleteImage}},[e._v("×")])]):e._e()])]),e._m(0)])])])},te=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"form__row"},[s("button",{staticClass:"btn btn_primary",attrs:{type:"submit"}},[e._v("Сохранить")])])}],se=(s("96cf"),s("3b8d")),ae=s("ea76"),ie=s.n(ae),ne={methods:{handleFormValidationErrors:function(e,t){try{e.response.data.success||(422===e.response.status?this.showValidationErrors(e.response.data.errors):this.showError(e.response.data,t))}catch(s){}},showValidationErrors:function(e){this.clearErrors(),Object.keys(e).forEach(function(t){var s=$("#"+t);s.addClass("validation-error"),e[t].forEach(function(e){$('<span class="validation-error__message">'+e+"</span>").insertAfter(s)})})},showError:function(e,t){this.clearErrors(),$('<span class="validation-error__message">'+e.message+"</span>").insertAfter($(t))},clearErrors:function(){$(".error").removeClass("validation-error"),$("span.validation-error__message").detach()}},deactivated:function(){this.clearErrors()}},re={name:"UserForm",components:{Multiselect:K.a,Datepicker:ie.a},mixins:[ne],props:{type:{type:String,default:"create"},user:{type:Object,default:function(){return{username:"",last_name:"",email:"",status:"10",password:"",roles:[],birthday:"",phone:"",additional_info:"",image:null}}}},data:function(){return{userObj:{},userToSubmit:{},availableRoles:[],availableStatuses:[],errors:[],imageData:"",show:!1}},methods:{getUserRoles:function(){var e=this;this.$store.dispatch("getDataList","USER_ROLES_LIST").then(function(t){e.availableRoles=Object.keys(t.role).map(function(e){var s={};return s.label=t.role[e],s.value=e,s}),e.userObj.roles=Object.keys(e.user.roles).map(function(e){var s={};return s.label=t.role[e],s.value=e,s})})},getUserStatusList:function(){var e=this;this.$store.dispatch("getDataList","USER_STATUS_LIST").then(function(t){e.availableStatuses=Object.keys(t.status).map(function(e){var s={};return s.label=t.status[e],s.value=e,s})})},createUser:function(e){var t=this;return this.$http.post(Q.user.CREATE,e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){return e}).catch(function(e){t.handleFormValidationErrors(e,t.$refs.form)})},editUser:function(e){var t=this;return this.$http.put(Q.user.UPDATE+"/"+this.user.id,e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){return e}).catch(function(e){t.handleFormValidationErrors(e,t.$refs.form)})},submitUser:function(){var e=Object(se["a"])(regeneratorRuntime.mark(function e(){var t,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.userToSubmit={username:this.userObj.username,last_name:this.userObj.last_name,email:this.userObj.email,status:this.userObj.status,password:this.userObj.password,roles:this.userObj.roles?this.userObj.roles.map(function(e){return e.value}):[],birthday:this.userObj.birthday?this.userObj.birthday+" 23:59:00":this.userObj.birthday,phone:this.userObj.phone,additional_info:this.userObj.additional_info,image:this.userObj.image,id:this.userObj.id},t=new FormData,t.append("username",this.userToSubmit.username),t.append("last_name",this.userToSubmit.last_name),t.append("email",this.userToSubmit.email),t.append("status",this.userToSubmit.status),"create"===this.type&&t.append("password",this.userToSubmit.password),t.append("roles",JSON.stringify(this.userToSubmit.roles)),t.append("birthday",this.userToSubmit.birthday),t.append("phone",this.userToSubmit.phone),t.append("additional_info",this.userToSubmit.additional_info),t.append("image",this.userToSubmit.image),"edit"!==this.type){e.next=18;break}return e.next=15,this.editUser(t);case 15:s=e.sent,e.next=21;break;case 18:return e.next=20,this.createUser(t);case 20:s=e.sent;case 21:s&&s.data&&!0===s.data.success&&this.$emit("userSubmitSuccess",this.userToSubmit);case 22:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),previewImage:function(e){var t=this,s=e.target;if(s.files&&s.files[0]){var a=new FileReader;a.onload=function(e){t.imageData=e.target.result,t.show=!!t.imageData},a.readAsDataURL(s.files[0])}this.userObj.image=this.$refs.file.files[0]},deleteImage:function(){this.userObj.image=null,this.imageData="",this.show=!1,this.$refs.file.value=""}},mounted:function(){this.userObj=Object.assign({},this.user),this.userObj.picture&&this.userObj.picture.length&&(this.imageData=this.userObj.picture[0],this.show=!0),this.getUserRoles(),this.getUserStatusList()}},oe=re,le=Object(v["a"])(oe,ee,te,!1,null,null,null),ce=le.exports,ue=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"section tables"},["create"===e.type?s("h2",{staticClass:"section__title"},[e._v("Создать стол")]):e._e(),"edit"===e.type?s("h2",{staticClass:"modal__title"},[e._v("Редактировать стол: "+e._s(e.tableObj.id))]):e._e(),s("div",{staticClass:"new-table"},[s("form",{ref:"form",staticClass:"form",on:{submit:function(t){return t.preventDefault(),e.submitItem(t)}}},[s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"name"}},[e._v("Название стола")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.tableObj.name,expression:"tableObj.name"}],attrs:{id:"name",type:"text",required:""},domProps:{value:e.tableObj.name},on:{input:function(t){t.target.composing||e.$set(e.tableObj,"name",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"seats_count"}},[e._v("Количество мест")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model.number",value:e.tableObj.seats_count,expression:"tableObj.seats_count",modifiers:{number:!0}}],attrs:{id:"seats_count",type:"number",required:""},domProps:{value:e.tableObj.seats_count},on:{input:function(t){t.target.composing||e.$set(e.tableObj,"seats_count",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]),s("div",{staticClass:"form__row"},[s("div",{staticClass:"dropzone"},[s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"image"}},[e._v("Изображение")]),e.show?e._e():s("p",[e._v("Перетащите сюда или выберите изображение "),s("i",{staticClass:"fa fa-cloud-upload"})]),s("input",{ref:"file",staticClass:"file-input",attrs:{type:"file",id:"image",accept:"image/*"},on:{change:e.previewImage}})]),e.show?s("div",{staticClass:"image"},[s("img",{attrs:{src:e.imageData,alt:""}}),s("span",{staticClass:"close",on:{click:e.deleteImage}},[e._v("×")])]):e._e()])]),s("div",{staticClass:"form__row form__row_m"},[s("div",{staticClass:"form__col"},[e._v("\n                    Свободен сейчас?\n                    "),"busy"===e.tableObj.busy_now?s("b",[e._v("Занят")]):e._e(),"draft"===e.tableObj.busy_now?s("b",[e._v("В процессе букинга")]):e._e(),e.tableObj.busy_now?e._e():s("b",[e._v("Свободен")]),e.tableObj.busy_now?s("button",{staticClass:"btn btn_m btn_pale",on:{click:function(t){return e.freeTable(e.tableObj)}}},[e._v("Освободить")]):e._e()]),s("div",{staticClass:"form__col"})]),e._m(0)])])])},de=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"form__row"},[s("button",{staticClass:"btn btn_primary",attrs:{type:"submit"}},[e._v("Сохранить")])])}],me={name:"TableForm",mixins:[ne],props:{type:{type:String,default:"create"},item:{type:Object,default:function(){return{name:"",id:0,seats_count:0,image:""}}}},data:function(){return{tableObj:{},imageData:"",show:!1}},methods:{createItem:function(e){var t=this;return this.$http.post(Q.table,e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){return e}).catch(function(e){t.handleFormValidationErrors(e,t.$refs.form)})},editItem:function(e){var t=this;return this.$http.post(Q.table+"/"+this.tableObj.id,e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){return e}).catch(function(e){t.handleFormValidationErrors(e,t.$refs.form)})},submitItem:function(){var e=Object(se["a"])(regeneratorRuntime.mark(function e(){var t,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.itemToSubmit={id:this.tableObj.id,name:this.tableObj.name,seats_count:this.tableObj.seats_count,image:this.tableObj.image},t=new FormData,t.append("name",this.itemToSubmit.name),t.append("seats_count",this.itemToSubmit.seats_count),t.append("image",this.itemToSubmit.image||""),t.append("restaurant_id","2"),"edit"!==this.type){e.next=12;break}return e.next=9,this.editItem(t);case 9:s=e.sent,e.next=15;break;case 12:return e.next=14,this.createItem(t);case 14:s=e.sent;case 15:s&&s.data&&!0===s.data.success&&this.$emit("itemSubmitSuccess",this.itemToSubmit);case 16:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),previewImage:function(e){var t=this,s=e.target;if(s.files&&s.files[0]){var a=new FileReader;a.onload=function(e){t.imageData=e.target.result,t.show=!!t.imageData},a.readAsDataURL(s.files[0])}this.tableObj.image=this.$refs.file.files[0]},deleteImage:function(){this.tableObj.image=null,this.imageData="",this.show=!1,this.$refs.file.value=""},freeTable:function(e){var t=this;e.busy_now="",this.$http.post("tables/"+e.id,e).then(function(e){t.tableObj.busy_now=e.data.data.busy_now})}},mounted:function(){var e=this;this.tableObj=Object.assign({},this.item),this.tableObj.image_url&&(this.imageData=this.tableObj.image_url,this.show=!0),this.$http.get("tables/"+this.tableObj.id).then(function(t){e.tableObj.busy_now=t.data.data.busy_now,e.addWatcher("tableObj")}).catch(function(){e.addWatcher("tableObj")})}},pe=me,be=Object(v["a"])(pe,ue,de,!1,null,null,null),he=be.exports,ve=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",["create"===e.type?s("h2",{staticClass:"section__title"},[e._v("Создать событие")]):e._e(),"edit"===e.type?s("h2",{staticClass:"modal__title"},[e._v("Редактировать событие: "+e._s(e.eventObj.title))]):e._e(),s("div",{staticClass:"new-event"},[s("form",{ref:"form",staticClass:"form",on:{submit:function(t){return t.preventDefault(),e.submitEvent(t)}}},[s("div",{staticClass:"form__row"},[s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"title"}},[e._v("Название")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.eventObj.title,expression:"eventObj.title"}],attrs:{id:"title",type:"text",required:""},domProps:{value:e.eventObj.title},on:{input:function(t){t.target.composing||e.$set(e.eventObj,"title",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"description"}},[e._v("Описание")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.eventObj.description,expression:"eventObj.description"}],attrs:{id:"description",type:"text"},domProps:{value:e.eventObj.description},on:{input:function(t){t.target.composing||e.$set(e.eventObj,"description",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"date_time"}},[e._v("Дата")]),s("div",{staticClass:"input-item"},[s("datepicker",{attrs:{id:"date_time",lang:"ru",type:"datetime",appendToBody:!1,format:"YYYY-MM-DD HH:mm:ss","time-picker-options":{start:"00:00",step:"00:30",end:"23:30"},"first-day-of-week":1,width:"auto",valueType:"format"},model:{value:e.eventObj.date_time,callback:function(t){e.$set(e.eventObj,"date_time",t)},expression:"eventObj.date_time"}})],1)])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"ticket_price"}},[e._v("Цена билета")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.eventObj.ticket_price,expression:"eventObj.ticket_price"}],attrs:{id:"ticket_price",type:"text"},domProps:{value:e.eventObj.ticket_price},on:{input:function(t){t.target.composing||e.$set(e.eventObj,"ticket_price",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"min_deposit"}},[e._v("Минимальный депозит")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.eventObj.min_deposit,expression:"eventObj.min_deposit"}],attrs:{id:"min_deposit",type:"text"},domProps:{value:e.eventObj.min_deposit},on:{input:function(t){t.target.composing||e.$set(e.eventObj,"min_deposit",t.target.value)}}})])]),s("div",{staticClass:"form__row"},[s("div",{staticClass:"dropzone"},[s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"image"}},[e._v("Изображение")]),e.show?e._e():s("p",[e._v("Перетащите сюда или выберите изображение "),s("i",{staticClass:"fa fa-cloud-upload"})]),s("input",{ref:"file",staticClass:"file-input",attrs:{type:"file",id:"image",accept:"image/*"},on:{change:e.previewImage}})]),e.show?s("div",{staticClass:"image"},[s("img",{attrs:{src:e.imageData,alt:""}}),s("span",{staticClass:"close",on:{click:e.deleteImage}},[e._v("×")])]):e._e()])]),e._m(0)])])])},_e=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"form__row"},[s("button",{staticClass:"btn btn_primary",attrs:{type:"submit"}},[e._v("Сохранить")])])}],fe={name:"EventForm",components:{Datepicker:ie.a},mixins:[ne],props:{type:{type:String,default:"create"},event:{type:Object,default:function(){return{date_time:"",id:"",image:"",title:"",description:"",min_deposit:0,ticket_price:0}}}},data:function(){return{eventObj:{},errors:[],imageData:"",show:!1}},methods:{createEvent:function(e){var t=this;return this.$http.post(Q.event,e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){return e}).catch(function(e){t.handleFormValidationErrors(e,t.$refs.form)})},editEvent:function(e){var t=this;return this.$http.post(Q.event+"/"+this.eventObj.id,e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){return e}).catch(function(e){t.handleFormValidationErrors(e,t.$refs.form)})},submitEvent:function(){var e=Object(se["a"])(regeneratorRuntime.mark(function e(){var t,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.eventToSubmit={date_time:this.eventObj.date_time,image:this.eventObj.image,description:this.eventObj.description,id:this.eventObj.id||"",title:this.eventObj.title,min_deposit:this.eventObj.min_deposit,ticket_price:this.eventObj.ticket_price},t=new FormData,t.append("date_time",this.eventToSubmit.date_time),t.append("min_deposit",this.eventToSubmit.min_deposit),t.append("ticket_price",this.eventToSubmit.ticket_price),t.append("description",this.eventToSubmit.description),t.append("image",this.eventToSubmit.image||""),t.append("title",this.eventToSubmit.title),t.append("restaurant_id","2"),"edit"!==this.type){e.next=15;break}return e.next=12,this.editEvent(t);case 12:s=e.sent,e.next=18;break;case 15:return e.next=17,this.createEvent(t);case 17:s=e.sent;case 18:s&&s.data&&!0===s.data.success&&this.$emit("itemSubmitSuccess",this.eventToSubmit);case 19:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),previewImage:function(e){var t=this,s=e.target;if(s.files&&s.files[0]){var a=new FileReader;a.onload=function(e){t.imageData=e.target.result,t.show=!!t.imageData},a.readAsDataURL(s.files[0])}this.eventObj.image=this.$refs.file.files[0]},deleteImage:function(){this.eventObj.image=null,this.imageData="",this.show=!1,this.$refs.file.value=""}},mounted:function(){this.eventObj=Object.assign({},this.event),this.eventObj.image_url&&(this.imageData=this.eventObj.image_url,this.show=!0),this.addWatcher("eventObj")}},ge=fe,je=Object(v["a"])(ge,ve,_e,!1,null,null,null),Ce=je.exports,Oe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.showeditClient?s("div",[s("div",{staticClass:"popup__close",on:{click:e.closeEditClient}},[e._v("×")]),e.clientObj?s("div",{staticClass:"client_info-edit"},["create"===e.typeClient?s("h3",{staticClass:"section__title"},[e._v("Создать нового клиента")]):e._e(),"edit"===e.typeClient?s("h3",{staticClass:"section__title"},[e._v("Редактировать данные: ")]):e._e(),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"name"}},[e._v("Имя")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.clientObj.name,expression:"clientObj.name"}],attrs:{id:"name",type:"text"},domProps:{value:e.clientObj.name},on:{input:function(t){t.target.composing||e.$set(e.clientObj,"name",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"last_name"}},[e._v("Фамилия")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.clientObj.last_name,expression:"clientObj.last_name"}],attrs:{id:"last_name",type:"text"},domProps:{value:e.clientObj.last_name},on:{input:function(t){t.target.composing||e.$set(e.clientObj,"last_name",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"email"}},[e._v("Email")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.clientObj.email,expression:"clientObj.email"}],attrs:{id:"email",type:"text"},domProps:{value:e.clientObj.email},on:{input:function(t){t.target.composing||e.$set(e.clientObj,"email",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"birthday"}},[e._v("День рождения")]),s("div",{staticClass:"input-item"},[s("datepicker",{attrs:{id:"birthday",lang:"ru",appendToBody:!1,"first-day-of-week":1,width:"auto",valueType:"format"},model:{value:e.clientObj.birthday,callback:function(t){e.$set(e.clientObj,"birthday",t)},expression:"clientObj.birthday"}})],1)]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"phone"}},[e._v("Телефон")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.clientObj.phone,expression:"clientObj.phone"}],attrs:{id:"phone",type:"text"},domProps:{value:e.clientObj.phone},on:{input:function(t){t.target.composing||e.$set(e.clientObj,"phone",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"client_comment"}},[e._v("Комментарий")]),s("div",{staticClass:"input-item"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.clientObj.comment,expression:"clientObj.comment"}],attrs:{id:"client_comment",type:"text"},domProps:{value:e.clientObj.comment},on:{input:function(t){t.target.composing||e.$set(e.clientObj,"comment",t.target.value)}}})])]),s("div",{staticClass:"form__row"},["edit"===e.typeClient?s("a",{staticClass:"btn btn_primary",attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.editClient(t)}}},[e._v("Редактировать ")]):s("a",{staticClass:"btn btn_primary",attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.creatNewClient(t)}}},[e._v("Сохранить")])])]):e._e()]):s("div",{staticClass:"new-event"},["create"===e.type?s("h2",{staticClass:"section__title"},[e._v("Создать резерв")]):e._e(),"edit"===e.type?s("h2",{staticClass:"modal__title"},[e._v("Редактировать резерв: "+e._s(e.reserveObj.id))]):e._e(),s("form",{ref:"form",staticClass:"form",on:{submit:function(t){return t.preventDefault(),e.submitReserve(t)}}},[s("div",{staticClass:"form__row"},[s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"client_id"}},[e._v("Клиент")]),s("div",{staticClass:"input-item client_multiselect",attrs:{id:"client_id"}},[s("multiselect",{attrs:{options:e.clients,searchable:!0,"internal-search":!1,loading:e.loadingUsers,"close-on-select":!0,"clear-on-select":!0,placeholder:"Начните вводить имя/телефон/email клиента",multiple:!1,trackBy:"id","custom-label":e.userWithEmailAndPhone,selectLabel:"Выбрать",deselectLabel:"Убрать",selectedLabel:"Выбрано"},on:{"search-change":e.searchUser},model:{value:e.clientObj,callback:function(t){e.clientObj=t},expression:"clientObj"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("По вашему запросу нет результатов. Создать нового клиента: "),s("i",{staticClass:"fas fa-plus-square",on:{click:e.showCreateClient}})])]),e.clientObj?e._e():s("div",{staticClass:"client_btn-create",on:{click:e.showCreateClient}},[s("i",{staticClass:"fas fa-plus-square"})])],1),e.clientObj?e._e():s("div",{staticClass:"booking__reserve booking__reserve2"},[s("div",{staticClass:"site-input"},[s("label",[e._v("Имя")]),s("div",{staticClass:"input-item "},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.newClient.name,expression:"newClient.name"}],attrs:{type:"text"},domProps:{value:e.newClient.name},on:{input:function(t){t.target.composing||e.$set(e.newClient,"name",t.target.value)}}})])]),s("div",{staticClass:"site-input "},[s("label",[e._v("Фамилия")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.newClient.last_name,expression:"newClient.last_name"}],attrs:{type:"text"},domProps:{value:e.newClient.last_name},on:{input:function(t){t.target.composing||e.$set(e.newClient,"last_name",t.target.value)}}})])]),s("div",{staticClass:"site-input "},[s("label",[e._v("Телефон")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.newClient.phone,expression:"newClient.phone"}],attrs:{type:"text"},domProps:{value:e.newClient.phone},on:{input:function(t){t.target.composing||e.$set(e.newClient,"phone",t.target.value)}}})])])])]),e.clientObj?s("div",{staticClass:"client_info"},[s("p",[s("span",[e._v(e._s(e.clientObj.name)+" "+e._s(e.clientObj.last_name)+" ")]),e._v(", "+e._s(e.clientObj.phone)+",\n                        "+e._s(e.clientObj.email)+"\n                    ")]),s("p",[e._v("\n                        "+e._s(e.clientObj.comment)+"\n                    ")]),s("p",[s("span",[e._v("Cредний чек: ")]),e._v(" "+e._s(e.clientObj.avg_check)+" грн, "),s("span",[e._v(" День рождения: ")]),e._v(" "+e._s(new Date(e.clientObj.birthday).toLocaleDateString())+"\n                    ")]),s("span",{directives:[{name:"show",rawName:"v-show",value:!e.showeditClient,expression:"!showeditClient"}],staticClass:"client_info-btn",on:{click:function(t){e.showeditClient=!e.showeditClient}}},[s("i",{staticClass:"far fa-edit"})])]):e._e()]),s("div",{staticClass:"form__row"},[s("div",{staticClass:"booking__reserve"},[s("div",{staticClass:"form__col"},[s("div",{staticClass:"booking__reserve-tables"},["booking"!==e.mode||e.addingTables?s("div",{staticClass:"site-input site-input_mb"},[s("label",{attrs:{for:"tables"}},[e._v("Стол или группа столов")]),s("div",{staticClass:"input-item",attrs:{id:"tables"}},[s("multiselect",{attrs:{options:e.allTables,searchable:!0,"close-on-select":!e.addingTables,"clear-on-select":!0,placeholder:e.addingTables?"Выберите столы":"Выберите стол",multiple:e.addingTables,trackBy:"id",label:"name",selectLabel:"Выбрать",deselectLabel:"Убрать",selectedLabel:"Выбрано"},scopedSlots:e._u([{key:"option",fn:function(t){return[s("img",{directives:[{name:"show",rawName:"v-show",value:t.option.image_url,expression:"props.option.image_url"}],staticClass:"option__image",attrs:{src:t.option.image_url,alt:t.option.name}}),s("div",{staticClass:"option__desc"},[s("span",{staticClass:"option__title"},[e._v(e._s(t.option.name)+" ")])])]}}],null,!1,73024460),model:{value:e.reserveObj.tables,callback:function(t){e.$set(e.reserveObj,"tables",t)},expression:"reserveObj.tables"}})],1)]):s("div",{staticClass:"site-input site-input_mb"},[s("label",{attrs:{for:"tables"}},[e._v("Стол или группа столов")]),s("div",{staticClass:"input-item",attrs:{id:"tables"}},[s("multiselect",{attrs:{value:e.reserveObj.tables,disabled:!0,options:e.allTables,searchable:!0,"close-on-select":!0,placeholder:"Выберите стол",multiple:e.reserveObj.tables&&e.reserveObj.tables.length>1,trackBy:"id",label:"name",selectLabel:"Выбрать",deselectLabel:"Убрать",selectedLabel:"Выбрано"},scopedSlots:e._u([{key:"option",fn:function(t){return[s("img",{directives:[{name:"show",rawName:"v-show",value:t.option.image_url,expression:"props.option.image_url"}],staticClass:"option__image",attrs:{src:t.option.image_url,alt:t.option.name}}),s("div",{staticClass:"option__desc"},[s("span",{staticClass:"option__title"},[e._v(e._s(t.option.name)+" ")])])]}}])})],1)]),e.addingTables?s("div",{staticClass:"booking__reserve-tables-cancel"},[s("i",{staticClass:"fas fa-times-circle",on:{click:e.cancelAddTables}})]):s("div",{staticClass:"booking__reserve-tables-add"},[s("i",{staticClass:"fas fa-plus-square",on:{click:e.addTables}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"event_id"}},[e._v("Событие")]),s("div",{staticClass:"input-item",attrs:{id:"event_id"}},[s("multiselect",{attrs:{options:e.futureEvents,searchable:!0,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите событие...",multiple:!1,trackBy:"id",label:"title",selectLabel:"Выбрать",deselectLabel:"Убрать",selectedLabel:"Выбрано"},model:{value:e.reserveObj.event,callback:function(t){e.$set(e.reserveObj,"event",t)},expression:"reserveObj.event"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("По вашему запросу нет результатов.")])])],1)]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"persons_count"}},[e._v("Количество человек")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.reserveObj.persons_count,expression:"reserveObj.persons_count"}],attrs:{id:"persons_count",type:"number"},domProps:{value:e.reserveObj.persons_count},on:{input:function(t){t.target.composing||e.$set(e.reserveObj,"persons_count",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"options"}},[e._v("Статус")]),s("div",{staticClass:"input-item",attrs:{id:"options"}},[s("multiselect",{attrs:{options:e.availableOptions,searchable:!1,"close-on-select":!1,placeholder:"Выберите статус",multiple:!0,selectLabel:"Выбрать",deselectLabel:"Убрать",selectedLabel:"Выбрано"},model:{value:e.reserveObj.options,callback:function(t){e.$set(e.reserveObj,"options",t)},expression:"reserveObj.options"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("По вашему запросу нет результатов.")])])],1)])]),s("div",{staticClass:"form__col"},[s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"date_start"}},[e._v(e._s("booking"===e.mode?"Время начала":"Дата и время начала"))]),s("div",{staticClass:"input-item"},[s("datepicker",{attrs:{id:"date_start",lang:"ru",type:"booking"===e.mode?"time":"datetime",appendToBody:!1,format:"booking"===e.mode?"HH:mm":"YYYY-MM-DD HH:mm","time-picker-options":{start:"17:00",step:"00:30",end:"23:30"},"first-day-of-week":1,width:"auto",valueType:"format",placeholder:"booking"===e.mode?"Выберите время":"Выберите дату и время"},model:{value:e.reserveObj.date_start,callback:function(t){e.$set(e.reserveObj,"date_start",t)},expression:"reserveObj.date_start"}})],1)]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"date_finish"}},[e._v(e._s("booking"===e.mode?"Время окончания":"Дата и время окончания"))]),s("div",{staticClass:"input-item"},[s("datepicker",{attrs:{id:"date_finish",lang:"ru",type:"booking"===e.mode?"time":"datetime",appendToBody:!1,format:"booking"===e.mode?"HH:mm":"YYYY-MM-DD HH:mm","time-picker-options":{start:"18:00",step:"00:30",end:"23:30"},"first-day-of-week":1,width:"auto",valueType:"format",placeholder:"booking"===e.mode?"Выберите время":"Выберите дату и время"},model:{value:e.reserveObj.date_finish,callback:function(t){e.$set(e.reserveObj,"date_finish",t)},expression:"reserveObj.date_finish"}})],1)]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"currency"}},[e._v("Валюта")]),s("div",{staticClass:"input-item",attrs:{id:"currency"}},[s("div",{staticClass:"radio-row"},e._l(e.currencies,function(t,a){return s("div",{key:a,staticClass:"radio-row__item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedCurrency,expression:"selectedCurrency"}],staticClass:"radio",attrs:{type:"radio",id:"currency"+a},domProps:{value:t,checked:e._q(e.selectedCurrency,t)},on:{change:function(s){e.selectedCurrency=t}}}),s("label",{attrs:{for:"currency"+a}},[e._v(e._s(t))])])}),0)])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"prepayment"}},[e._v("Предоплата")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.reserveObj.prepayment,expression:"reserveObj.prepayment"}],attrs:{id:"prepayment",type:"number"},domProps:{value:e.reserveObj.prepayment},on:{input:function(t){t.target.composing||e.$set(e.reserveObj,"prepayment",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"sms_send_time"}},[e._v("SMS-напоминание")]),s("div",{staticClass:"input-item",attrs:{id:"sms_send_time"}},[s("div",{staticClass:"checkbox-row"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.smsObj["1hour"],expression:"smsObj['1hour']"}],staticClass:"checkbox checkbox_normal",attrs:{type:"checkbox",id:"1hour"},domProps:{checked:Array.isArray(e.smsObj["1hour"])?e._i(e.smsObj["1hour"],null)>-1:e.smsObj["1hour"]},on:{change:function(t){var s=e.smsObj["1hour"],a=t.target,i=!!a.checked;if(Array.isArray(s)){var n=null,r=e._i(s,n);a.checked?r<0&&e.$set(e.smsObj,"1hour",s.concat([n])):r>-1&&e.$set(e.smsObj,"1hour",s.slice(0,r).concat(s.slice(r+1)))}else e.$set(e.smsObj,"1hour",i)}}}),s("label",{attrs:{for:"1hour"}},[e._v("За 1 час")])]),s("div",{staticClass:"checkbox-row"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.smsObj["3hours"],expression:"smsObj['3hours']"}],staticClass:"checkbox checkbox_normal",attrs:{type:"checkbox",id:"3hours"},domProps:{checked:Array.isArray(e.smsObj["3hours"])?e._i(e.smsObj["3hours"],null)>-1:e.smsObj["3hours"]},on:{change:function(t){var s=e.smsObj["3hours"],a=t.target,i=!!a.checked;if(Array.isArray(s)){var n=null,r=e._i(s,n);a.checked?r<0&&e.$set(e.smsObj,"3hours",s.concat([n])):r>-1&&e.$set(e.smsObj,"3hours",s.slice(0,r).concat(s.slice(r+1)))}else e.$set(e.smsObj,"3hours",i)}}}),s("label",{attrs:{for:"3hours"}},[e._v("За 3 часа")])])])])])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"comment"}},[e._v("Комментарий")]),s("div",{staticClass:"input-item"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.reserveObj.comment,expression:"reserveObj.comment"}],attrs:{id:"comment",type:"text"},domProps:{value:e.reserveObj.comment},on:{input:function(t){t.target.composing||e.$set(e.reserveObj,"comment",t.target.value)}}})])]),s("div",{staticClass:"dropzone"},[s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"image"}},[e._v("Изображение")]),e.show?e._e():s("p",[e._v("Перетащите сюда или выберите изображение "),s("i",{staticClass:"fa fa-cloud-upload"})]),s("input",{ref:"file",staticClass:"file-input",attrs:{type:"file",id:"image",accept:"image/*"},on:{change:e.previewImage}})]),e.show?s("div",{staticClass:"image"},[s("img",{attrs:{src:e.imageData,alt:""}}),s("span",{staticClass:"close",on:{click:e.deleteImage}},[e._v("×")])]):e._e()]),e._m(0)])])])])},ye=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"form__row"},[s("button",{staticClass:"btn btn_primary",attrs:{type:"submit"}},[e._v("Сохранить")])])}],we=(s("28a5"),s("c1df")),Te=s.n(we),ke=3,Se={name:"ReserveForm",components:{Multiselect:K.a,Datepicker:ie.a},mixins:[ne],props:{type:{type:String,default:"create"},mode:{type:String,default:""},reserve:{type:Object,default:function(){return{id:"",client:{},client_id:"",table:{},tables:[],persons_count:"",date_start:"",date_finish:"",options:"",prepayment:"",comment:"",currency:""}}}},data:function(){return{reserveObj:{tables:[],options:[],sms_send_time:[]},itemToSubmit:{},currencies:["UAH","USD","EUR","RUR"],selectedCurrency:"UAH",clients:[{name:"",phone:""}],loadingUsers:!1,futureEvents:[],availableOptions:["ПО","ПС","ПЗ"],smsObj:{"1hour":!1,"3hours":!1},allTables:[{label:"",value:""}],errors:[],searchQuery:"",selectedEvent:{},day:"",imageData:"",show:!1,showeditClient:!1,clientObj:null,typeClient:"edit",addingTables:!1,tableBackup:{},newClient:{name:"",phone:"",last_name:""}}},computed:{computedOptions:function(){var e="";return this.reserveObj.options.forEach(function(t){e.length?e+=", ".concat(t):e=t||""}),e}},watch:{"reserveObj.prepayment":{handler:function(e){e&&-1===this.reserveObj.options.indexOf("ПО")&&this.reserveObj.options.push("ПО")}}},methods:{getClients:function(){var e=this;this.$http.get("/clients",{params:{search:this.searchQuery}}).then(function(t){t&&t.data&&t.data.data&&t.data.data.items&&(e.clients=t.data.data.items,e.loadingUsers=!1)})},getTables:function(){var e=this;this.$http.get("/tables").then(function(t){t&&t.data&&t.data.data&&t.data.data.items&&(e.allTables=t.data.data.items)})},getFutureEvents:function(){var e=this;this.$http.get("/events/dropdown").then(function(t){t&&t.data.data&&(e.futureEvents=t.data.data)})},createReserve:function(e){var t=this;return this.$http.post(Q.reserve,e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){return e}).catch(function(e){t.handleFormValidationErrors(e,t.$refs.form)})},editReserve:function(e){var t=this;return this.$http.post(Q.reserve+"/"+this.reserveObj.id,e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){return e}).catch(function(e){t.handleFormValidationErrors(e,t.$refs.form)})},submitReserve:function(){var e=Object(se["a"])(regeneratorRuntime.mark(function e(){var t,s,a,i,n,r,o=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.reserveObj.prepayment&&-1===this.reserveObj.options.indexOf("ПО")&&this.reserveObj.options.push("ПО"),this.clientObj){e.next=4;break}return e.next=4,this.$http.post(Q.client,{name:this.newClient.name,phone:this.newClient.phone,last_name:this.newClient.last_name}).then(function(e){e&&e.data.data&&(o.clientObj=e.data.data)}).catch(function(e){o.handleFormValidationErrors(e,o.$refs.form)});case 4:if(this.itemToSubmit={id:this.reserveObj.id,client_id:this.clientObj?this.clientObj.id:"",tables:this.reserveObj.tables,persons_count:this.reserveObj.persons_count,date_start:this.reserveObj.date_start,date_finish:this.reserveObj.date_finish,options:this.reserveObj.options,currency:this.selectedCurrency,prepayment:this.reserveObj.prepayment,sms_send_time:[],event_id:this.reserveObj.event?this.reserveObj.event.id:"",comment:this.reserveObj.comment,image:this.reserveObj.image},"booking"!==this.mode?(t="YYYY-MM-DD HH:mm:ss".length,t-this.itemToSubmit.date_start.length===3&&(this.itemToSubmit.date_start=this.itemToSubmit.date_start+":00"),t-this.itemToSubmit.date_finish.length===3&&(this.itemToSubmit.date_finish=this.itemToSubmit.date_finish+":00")):(this.itemToSubmit.date_start=this.day+" "+this.itemToSubmit.date_start+":00",this.itemToSubmit.date_finish=this.itemToSubmit.date_finish?this.day+" "+this.itemToSubmit.date_finish+":00":""),this.itemToSubmit.date_finish&&":00"!==this.itemToSubmit.date_finish||(this.itemToSubmit.date_finish=Te()((new Date).setTime(new Date(this.itemToSubmit.date_start).getTime()+60*ke*60*1e3)).format("YYYY-MM-DD HH:mm:ss")),s=[],this.smsObj["1hour"]&&s.push(this.dateStartSubtractHours(1)),this.smsObj["3hours"]&&s.push(this.dateStartSubtractHours(3)),this.itemToSubmit.sms_send_time=s,a=new FormData,a.append("restaurant_id","2"),a.append("client_id",this.itemToSubmit.client_id),a.append("persons_count",this.itemToSubmit.persons_count||""),a.append("prepayment",this.itemToSubmit.prepayment?this.itemToSubmit.prepayment+" "+this.itemToSubmit.currency:""),a.append("date_start",this.itemToSubmit.date_start),a.append("date_finish",this.itemToSubmit.date_finish),a.append("options",this.computedOptions),a.append("comment",this.itemToSubmit.comment||""),a.append("event_id",this.itemToSubmit.event_id),a.append("image",this.itemToSubmit.image||""),this.itemToSubmit.tables.length)for(i=0;i<this.itemToSubmit.tables.length;i++)a.append("tables["+i+"]",this.itemToSubmit.tables[i].id);else this.itemToSubmit.tables.id&&a.append("tables[0]",this.itemToSubmit.tables.id);if(this.itemToSubmit.sms_send_time.length)for(n=0;n<this.itemToSubmit.sms_send_time.length;n++)a.append("sms_send_time["+n+"]",this.itemToSubmit.sms_send_time[n]);if("edit"!==this.type){e.next=30;break}return e.next=27,this.editReserve(a);case 27:r=e.sent,e.next=33;break;case 30:return e.next=32,this.createReserve(a);case 32:r=e.sent;case 33:r&&r.data&&!0===r.data.success&&this.$emit("itemSubmitSuccess",this.itemToSubmit);case 34:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),userWithEmailAndPhone:function(e){return e.last_name?e.email?e.name+" "+e.last_name+" — "+e.email+" — "+e.phone:e.name+" "+e.last_name+" — "+e.phone:e.email?e.name+" — "+e.email+" — "+e.phone:e.name+" — "+e.phone},searchUser:function(e){this.searchQuery=e,this.getClients()},previewImage:function(e){var t=this,s=e.target;if(s.files&&s.files[0]){var a=new FileReader;a.onload=function(e){t.imageData=e.target.result,t.show=!!t.imageData},a.readAsDataURL(s.files[0])}this.reserveObj.image=this.$refs.file.files[0]},deleteImage:function(){this.reserveObj.image=null,this.imageData="",this.show=!1,this.$refs.file.value=""},editClient:function(){var e=this;this.$http.put(Q.client+"/"+this.clientObj.id,{name:this.clientObj.name,last_name:this.clientObj.last_name,email:this.clientObj.email,birthday:this.clientObj.birthday,phone:this.clientObj.phone,comment:this.clientObj.comment,image:this.clientObj.image}).then(function(t){t&&t.data.data&&(e.showeditClient=!e.showeditClient,e.typeClient="edit",e.getClients())}).catch(function(t){e.handleFormValidationErrors(t,e.$refs.form)})},creatNewClient:function(){var e=this;this.$http.post(Q.client,{name:this.clientObj.name,last_name:this.clientObj.last_name,email:this.clientObj.email,birthday:this.clientObj.birthday,phone:this.clientObj.phone,comment:this.clientObj.comment,image:this.clientObj.image}).then(function(t){t&&t.data.data&&(e.clientObj.id=t.data.data.id,e.showeditClient=!e.showeditClient,e.typeClient="edit",e.getClients())}).catch(function(t){e.handleFormValidationErrors(t,e.$refs.form)})},showCreateClient:function(){this.typeClient="create",this.clientObj={name:"",last_name:"",email:"",birthday:"",phone:"",comment:"",image:"",avg_check:""},this.showeditClient=!this.showeditClient},closeEditClient:function(){this.clientObj.id||(this.clientObj=null),this.showeditClient=!this.showeditClient},addTables:function(){this.addingTables=!0,this.tableBackup=[].concat(this.reserveObj.tables)},cancelAddTables:function(){this.reserveObj.tables=[].concat(this.tableBackup),this.addingTables=!1},dateStartSubtractHours:function(e){return Te()((new Date).setTime(new Date(this.itemToSubmit.date_start).getTime()-60*e*60*1e3)).format("YYYY-MM-DD HH:mm:ss")}},mounted:function(){var e=this;if(this.reserveObj=Object.assign({},this.reserve),this.itemToSubmit.date_start=this.reserveObj.date_start,this.reserve.smses&&this.reserve.smses.length&&this.reserve.smses.forEach(function(t){e.dateStartSubtractHours(1)===Te()(t.send_time).format("YYYY-MM-DD HH:mm:ss")&&(e.smsObj["1hour"]=!0),e.dateStartSubtractHours(3)===Te()(t.send_time).format("YYYY-MM-DD HH:mm:ss")&&(e.smsObj["3hours"]=!0)}),"booking"===this.mode&&(this.day=this.reserveObj.date_start.slice(0,10),this.reserveObj.date_start=this.reserveObj.date_start.slice(11,this.reserveObj.date_start.length-3),this.reserveObj.date_finish=this.reserveObj.date_finish.slice(11,this.reserveObj.date_finish.length-3)),"string"===typeof this.reserveObj.options?this.reserveObj.options=this.reserveObj.options.split(", "):this.reserveObj.options=[],this.reserveObj.image_url&&(this.imageData=this.reserveObj.image_url,this.show=!0),this.reserve.prepayment){var t=this.reserve.prepayment.split(" ");this.reserveObj.prepayment=t[0],this.reserveObj.currency=t[1]}this.reserve.client&&(this.clientObj=this.reserve.client),Promise.all([this.getClients(),this.getTables(),this.getFutureEvents()]).then(this.addWatcher("reserveObj"))}},xe=Se,Pe=Object(v["a"])(xe,Oe,ye,!1,null,null,null),De=Pe.exports,$e=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.showeditClient?s("div",[s("div",{staticClass:"popup__close",on:{click:e.closeEditClient}},[e._v("×")]),e.clientObj?s("div",{staticClass:"client_info-edit"},["create"===e.typeClient?s("h3",{staticClass:"section__title"},[e._v("Создать нового клиента")]):e._e(),"edit"===e.typeClient?s("h3",{staticClass:"section__title"},[e._v("Редактировать данные: ")]):e._e(),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"name"}},[e._v("Имя")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.clientObj.name,expression:"clientObj.name"}],attrs:{id:"name",type:"text"},domProps:{value:e.clientObj.name},on:{input:function(t){t.target.composing||e.$set(e.clientObj,"name",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"last_name"}},[e._v("Фамилия")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.clientObj.last_name,expression:"clientObj.last_name"}],attrs:{id:"last_name",type:"text"},domProps:{value:e.clientObj.last_name},on:{input:function(t){t.target.composing||e.$set(e.clientObj,"last_name",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"email"}},[e._v("Email")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.clientObj.email,expression:"clientObj.email"}],attrs:{id:"email",type:"text"},domProps:{value:e.clientObj.email},on:{input:function(t){t.target.composing||e.$set(e.clientObj,"email",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"birthday"}},[e._v("День рождения")]),s("div",{staticClass:"input-item"},[s("datepicker",{attrs:{id:"birthday",lang:"ru",appendToBody:!1,"first-day-of-week":1,width:"auto",valueType:"format"},model:{value:e.clientObj.birthday,callback:function(t){e.$set(e.clientObj,"birthday",t)},expression:"clientObj.birthday"}})],1)]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"phone"}},[e._v("Телефон")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.clientObj.phone,expression:"clientObj.phone"}],attrs:{id:"phone",type:"text"},domProps:{value:e.clientObj.phone},on:{input:function(t){t.target.composing||e.$set(e.clientObj,"phone",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"client_comment"}},[e._v("Комментарий")]),s("div",{staticClass:"input-item"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.clientObj.comment,expression:"clientObj.comment"}],attrs:{id:"client_comment",type:"text"},domProps:{value:e.clientObj.comment},on:{input:function(t){t.target.composing||e.$set(e.clientObj,"comment",t.target.value)}}})])]),s("div",{staticClass:"form__row"},["edit"===e.typeClient?s("a",{staticClass:"btn btn_primary",attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.editClient(t)}}},[e._v("Редактировать ")]):s("a",{staticClass:"btn btn_primary",attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.creatNewClient(t)}}},[e._v("Сохранить")])])]):e._e()]):s("div",{staticClass:"new-event"},["create"===e.type?s("h2",{staticClass:"section__title"},[e._v("Создать резерв")]):e._e(),"edit"===e.type?s("h2",{staticClass:"modal__title"},[e._v("Редактировать резерв: "+e._s(e.reserveObj.id))]):e._e(),s("form",{ref:"form",staticClass:"form",on:{submit:function(t){return t.preventDefault(),e.submitReserve(t)}}},[s("div",{staticClass:"form__row"},[s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"client_id"}},[e._v("Клиент")]),s("div",{staticClass:"input-item client_multiselect",attrs:{id:"client_id"}},[s("multiselect",{attrs:{options:e.clients,searchable:!0,"internal-search":!1,loading:e.loadingUsers,"close-on-select":!0,"clear-on-select":!0,placeholder:"Начните вводить имя/телефон/email клиента",multiple:!1,trackBy:"id","custom-label":e.userWithEmailAndPhone,selectLabel:"Выбрать",deselectLabel:"Убрать",selectedLabel:"Выбрано"},on:{"search-change":e.searchUser},model:{value:e.clientObj,callback:function(t){e.clientObj=t},expression:"clientObj"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("По вашему запросу нет результатов. Создать нового клиента: "),s("i",{staticClass:"fas fa-plus-square",on:{click:e.showCreateClient}})])]),e.clientObj?e._e():s("div",{staticClass:"client_btn-create",on:{click:e.showCreateClient}},[s("i",{staticClass:"fas fa-plus-square"})])],1),e.clientObj?e._e():s("div",{staticClass:"booking__reserve booking__reserve2"},[s("div",{staticClass:"site-input"},[s("label",[e._v("Имя")]),s("div",{staticClass:"input-item "},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.newClient.name,expression:"newClient.name"}],attrs:{type:"text"},domProps:{value:e.newClient.name},on:{input:function(t){t.target.composing||e.$set(e.newClient,"name",t.target.value)}}})])]),s("div",{staticClass:"site-input "},[s("label",[e._v("Фамилия")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.newClient.last_name,expression:"newClient.last_name"}],attrs:{type:"text"},domProps:{value:e.newClient.last_name},on:{input:function(t){t.target.composing||e.$set(e.newClient,"last_name",t.target.value)}}})])]),s("div",{staticClass:"site-input "},[s("label",[e._v("Телефон")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.newClient.phone,expression:"newClient.phone"}],attrs:{type:"text"},domProps:{value:e.newClient.phone},on:{input:function(t){t.target.composing||e.$set(e.newClient,"phone",t.target.value)}}})])])])]),e.clientObj?s("div",{staticClass:"client_info"},[s("p",[s("span",[e._v(e._s(e.clientObj.name)+" "+e._s(e.clientObj.last_name)+" ")]),e._v(", "+e._s(e.clientObj.phone)+",\n                        "+e._s(e.clientObj.email)+"\n                    ")]),s("p",[e._v("\n                        "+e._s(e.clientObj.comment)+"\n                    ")]),s("p",[s("span",[e._v("Cредний чек: ")]),e._v(" "+e._s(e.clientObj.avg_check)+" грн, "),s("span",[e._v(" День рождения: ")]),e._v(" "+e._s(new Date(e.clientObj.birthday).toLocaleDateString())+"\n                    ")]),s("span",{directives:[{name:"show",rawName:"v-show",value:!e.showeditClient,expression:"!showeditClient"}],staticClass:"client_info-btn",on:{click:function(t){e.showeditClient=!e.showeditClient}}},[s("i",{staticClass:"far fa-edit"})])]):e._e()]),s("div",{staticClass:"form__row"},[s("div",{staticClass:"booking__reserve"},[s("div",{staticClass:"form__col"},[s("div",{staticClass:"booking__reserve-tables"},["booking"!==e.mode||e.addingTables?s("div",{staticClass:"site-input site-input_mb"},[s("label",{attrs:{for:"tables"}},[e._v("Стол или группа столов")]),s("div",{staticClass:"input-item",attrs:{id:"tables"}},[s("multiselect",{attrs:{options:e.allTables,searchable:!0,"close-on-select":!e.addingTables,"clear-on-select":!0,placeholder:e.addingTables?"Выберите столы":"Выберите стол",multiple:e.addingTables,trackBy:"id",label:"name",selectLabel:"Выбрать",deselectLabel:"Убрать",selectedLabel:"Выбрано"},scopedSlots:e._u([{key:"option",fn:function(t){return[s("img",{directives:[{name:"show",rawName:"v-show",value:t.option.image_url,expression:"props.option.image_url"}],staticClass:"option__image",attrs:{src:t.option.image_url,alt:t.option.name}}),s("div",{staticClass:"option__desc"},[s("span",{staticClass:"option__title"},[e._v(e._s(t.option.name)+" ")])])]}}],null,!1,73024460),model:{value:e.reserveObj.tables,callback:function(t){e.$set(e.reserveObj,"tables",t)},expression:"reserveObj.tables"}})],1)]):s("div",{staticClass:"site-input site-input_mb"},[s("label",{attrs:{for:"tables"}},[e._v("Стол или группа столов")]),s("div",{staticClass:"input-item",attrs:{id:"tables"}},[s("multiselect",{attrs:{value:e.reserveObj.tables,disabled:!0,options:e.allTables,searchable:!0,"close-on-select":!0,placeholder:"Выберите стол",multiple:e.reserveObj.tables&&e.reserveObj.tables.length>1,trackBy:"id",label:"name",selectLabel:"Выбрать",deselectLabel:"Убрать",selectedLabel:"Выбрано"},scopedSlots:e._u([{key:"option",fn:function(t){return[s("img",{directives:[{name:"show",rawName:"v-show",value:t.option.image_url,expression:"props.option.image_url"}],staticClass:"option__image",attrs:{src:t.option.image_url,alt:t.option.name}}),s("div",{staticClass:"option__desc"},[s("span",{staticClass:"option__title"},[e._v(e._s(t.option.name)+" ")])])]}}])})],1)]),e.addingTables?s("div",{staticClass:"booking__reserve-tables-cancel"},[s("i",{staticClass:"fas fa-times-circle",on:{click:e.cancelAddTables}})]):s("div",{staticClass:"booking__reserve-tables-add"},[s("i",{staticClass:"fas fa-plus-square",on:{click:e.addTables}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"event_id"}},[e._v("Событие")]),s("div",{staticClass:"input-item",attrs:{id:"event_id"}},[s("multiselect",{attrs:{options:e.futureEvents,searchable:!0,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите событие...",multiple:!1,trackBy:"id",label:"title",selectLabel:"Выбрать",deselectLabel:"Убрать",selectedLabel:"Выбрано"},model:{value:e.reserveObj.event,callback:function(t){e.$set(e.reserveObj,"event",t)},expression:"reserveObj.event"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("По вашему запросу нет результатов.")])])],1)]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"persons_count"}},[e._v("Количество человек")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.reserveObj.persons_count,expression:"reserveObj.persons_count"}],attrs:{id:"persons_count",type:"number"},domProps:{value:e.reserveObj.persons_count},on:{input:function(t){t.target.composing||e.$set(e.reserveObj,"persons_count",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"options"}},[e._v("Статус")]),s("div",{staticClass:"input-item",attrs:{id:"options"}},[s("multiselect",{attrs:{options:e.availableOptions,searchable:!1,"close-on-select":!1,placeholder:"Выберите статус",multiple:!0,selectLabel:"Выбрать",deselectLabel:"Убрать",selectedLabel:"Выбрано"},model:{value:e.reserveObj.options,callback:function(t){e.$set(e.reserveObj,"options",t)},expression:"reserveObj.options"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("По вашему запросу нет результатов.")])])],1)])]),s("div",{staticClass:"form__col"},[s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"date_start"}},[e._v(e._s("booking"===e.mode?"Время начала":"Дата и время начала"))]),s("div",{staticClass:"input-item"},[s("datepicker",{attrs:{id:"date_start",lang:"ru",type:"booking"===e.mode?"time":"datetime",appendToBody:!1,format:"booking"===e.mode?"HH:mm":"YYYY-MM-DD HH:mm","time-picker-options":{start:"17:00",step:"00:30",end:"23:30"},"first-day-of-week":1,width:"auto",valueType:"format",placeholder:"booking"===e.mode?"Выберите время":"Выберите дату и время"},model:{value:e.reserveObj.date_start,callback:function(t){e.$set(e.reserveObj,"date_start",t)},expression:"reserveObj.date_start"}})],1)]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"date_finish"}},[e._v(e._s("booking"===e.mode?"Время окончания":"Дата и время окончания"))]),s("div",{staticClass:"input-item"},[s("datepicker",{attrs:{id:"date_finish",lang:"ru",type:"booking"===e.mode?"time":"datetime",appendToBody:!1,format:"booking"===e.mode?"HH:mm":"YYYY-MM-DD HH:mm","time-picker-options":{start:"18:00",step:"00:30",end:"23:30"},"first-day-of-week":1,width:"auto",valueType:"format",placeholder:"booking"===e.mode?"Выберите время":"Выберите дату и время"},model:{value:e.reserveObj.date_finish,callback:function(t){e.$set(e.reserveObj,"date_finish",t)},expression:"reserveObj.date_finish"}})],1)]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"currency"}},[e._v("Валюта")]),s("div",{staticClass:"input-item",attrs:{id:"currency"}},[s("div",{staticClass:"radio-row"},e._l(e.currencies,function(t,a){return s("div",{key:a,staticClass:"radio-row__item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedCurrency,expression:"selectedCurrency"}],staticClass:"radio",attrs:{type:"radio",id:"currency"+a},domProps:{value:t,checked:e._q(e.selectedCurrency,t)},on:{change:function(s){e.selectedCurrency=t}}}),s("label",{attrs:{for:"currency"+a}},[e._v(e._s(t))])])}),0)])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"prepayment"}},[e._v("Предоплата")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.reserveObj.prepayment,expression:"reserveObj.prepayment"}],attrs:{id:"prepayment",type:"number"},domProps:{value:e.reserveObj.prepayment},on:{input:function(t){t.target.composing||e.$set(e.reserveObj,"prepayment",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"sms_send_time"}},[e._v("SMS-напоминание")]),s("div",{staticClass:"input-item",attrs:{id:"sms_send_time"}},[s("div",{staticClass:"checkbox-row"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.smsObj["1hour"],expression:"smsObj['1hour']"}],staticClass:"checkbox checkbox_normal",attrs:{type:"checkbox",id:"1hour"},domProps:{checked:Array.isArray(e.smsObj["1hour"])?e._i(e.smsObj["1hour"],null)>-1:e.smsObj["1hour"]},on:{change:function(t){var s=e.smsObj["1hour"],a=t.target,i=!!a.checked;if(Array.isArray(s)){var n=null,r=e._i(s,n);a.checked?r<0&&e.$set(e.smsObj,"1hour",s.concat([n])):r>-1&&e.$set(e.smsObj,"1hour",s.slice(0,r).concat(s.slice(r+1)))}else e.$set(e.smsObj,"1hour",i)}}}),s("label",{attrs:{for:"1hour"}},[e._v("За 1 час")])]),s("div",{staticClass:"checkbox-row"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.smsObj["3hours"],expression:"smsObj['3hours']"}],staticClass:"checkbox checkbox_normal",attrs:{type:"checkbox",id:"3hours"},domProps:{checked:Array.isArray(e.smsObj["3hours"])?e._i(e.smsObj["3hours"],null)>-1:e.smsObj["3hours"]},on:{change:function(t){var s=e.smsObj["3hours"],a=t.target,i=!!a.checked;if(Array.isArray(s)){var n=null,r=e._i(s,n);a.checked?r<0&&e.$set(e.smsObj,"3hours",s.concat([n])):r>-1&&e.$set(e.smsObj,"3hours",s.slice(0,r).concat(s.slice(r+1)))}else e.$set(e.smsObj,"3hours",i)}}}),s("label",{attrs:{for:"3hours"}},[e._v("За 3 часа")])])])])])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"comment"}},[e._v("Комментарий")]),s("div",{staticClass:"input-item"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.reserveObj.comment,expression:"reserveObj.comment"}],attrs:{id:"comment",type:"text"},domProps:{value:e.reserveObj.comment},on:{input:function(t){t.target.composing||e.$set(e.reserveObj,"comment",t.target.value)}}})])]),s("div",{staticClass:"dropzone"},[s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"image"}},[e._v("Изображение")]),e.show?e._e():s("p",[e._v("Перетащите сюда или выберите изображение "),s("i",{staticClass:"fa fa-cloud-upload"})]),s("input",{ref:"file",staticClass:"file-input",attrs:{type:"file",id:"image",accept:"image/*"},on:{change:e.previewImage}})]),e.show?s("div",{staticClass:"image"},[s("img",{attrs:{src:e.imageData,alt:""}}),s("span",{staticClass:"close",on:{click:e.deleteImage}},[e._v("×")])]):e._e()]),e._m(0)])])])])},Me=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"form__row"},[s("button",{staticClass:"btn btn_primary",attrs:{type:"submit"}},[e._v("Сохранить и перенести в Резервы")])])}],Ee=3,Fe={name:"ReserveFromAppForm",components:{Multiselect:K.a,Datepicker:ie.a},mixins:[ne],props:{type:{type:String,default:"create"},mode:{type:String,default:""},reserve:{type:Object,default:function(){return{id:"",client:{},client_id:"",table:{},tables:[],persons_count:"",date_start:"",date_finish:"",options:"",prepayment:"",comment:"",currency:""}}}},data:function(){return{reserveObj:{tables:[],options:[],sms_send_time:[]},itemToSubmit:{},currencies:["UAH","USD","EUR","RUR"],selectedCurrency:"UAH",clients:[{name:"",phone:""}],loadingUsers:!1,futureEvents:[],availableOptions:["ПО","ПС","ПЗ"],smsObj:{"1hour":!1,"3hours":!1},allTables:[{label:"",value:""}],errors:[],searchQuery:"",selectedEvent:{},day:"",imageData:"",show:!1,showeditClient:!1,clientObj:null,typeClient:"edit",addingTables:!1,tableBackup:{},newClient:{name:"",phone:"",last_name:""}}},computed:{computedOptions:function(){var e="";return this.reserveObj.options.forEach(function(t){e.length?e+=", ".concat(t):e=t||""}),e}},watch:{"reserveObj.prepayment":{handler:function(e){e&&-1===this.reserveObj.options.indexOf("ПО")&&this.reserveObj.options.push("ПО")}}},methods:{getClients:function(){var e=this;this.$http.get("/clients",{params:{search:this.searchQuery}}).then(function(t){t&&t.data&&t.data.data&&t.data.data.items&&(e.clients=t.data.data.items,e.loadingUsers=!1)})},getTables:function(){var e=this;this.$http.get("/tables").then(function(t){t&&t.data&&t.data.data&&t.data.data.items&&(e.allTables=t.data.data.items)})},getFutureEvents:function(){var e=this;this.$http.get("/events/dropdown").then(function(t){t&&t.data.data&&(e.futureEvents=t.data.data)})},createReserve:function(e){var t=this;return this.$http.post(Q.reserve,e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){return e}).catch(function(e){t.handleFormValidationErrors(e,t.$refs.form)})},editReserve:function(e){var t=this;return this.$http.post(Q.reserve+"/"+this.reserveObj.id,e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){return e}).catch(function(e){t.handleFormValidationErrors(e,t.$refs.form)})},submitReserve:function(){var e=Object(se["a"])(regeneratorRuntime.mark(function e(){var t,s,a,i,n,r,o=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.reserveObj.prepayment&&-1===this.reserveObj.options.indexOf("ПО")&&this.reserveObj.options.push("ПО"),this.clientObj){e.next=4;break}return e.next=4,this.$http.post(Q.client,{name:this.newClient.name,phone:this.newClient.phone,last_name:this.newClient.last_name}).then(function(e){e&&e.data.data&&(o.clientObj=e.data.data)}).catch(function(e){o.handleFormValidationErrors(e,o.$refs.form)});case 4:if(this.itemToSubmit={id:this.reserveObj.id,client_id:this.clientObj?this.clientObj.id:"",tables:this.reserveObj.tables,persons_count:this.reserveObj.persons_count,date_start:this.reserveObj.date_start,date_finish:this.reserveObj.date_finish,options:this.reserveObj.options,currency:this.selectedCurrency,prepayment:this.reserveObj.prepayment,sms_send_time:[],event_id:this.reserveObj.event?this.reserveObj.event.id:"",comment:this.reserveObj.comment,image:this.reserveObj.image},"booking"!==this.mode?(t="YYYY-MM-DD HH:mm:ss".length,t-this.itemToSubmit.date_start.length===3&&(this.itemToSubmit.date_start=this.itemToSubmit.date_start+":00"),t-this.itemToSubmit.date_finish.length===3&&(this.itemToSubmit.date_finish=this.itemToSubmit.date_finish+":00")):(this.itemToSubmit.date_start=this.day+" "+this.itemToSubmit.date_start+":00",this.itemToSubmit.date_finish=this.itemToSubmit.date_finish?this.day+" "+this.itemToSubmit.date_finish+":00":""),this.itemToSubmit.date_finish&&":00"!==this.itemToSubmit.date_finish||(this.itemToSubmit.date_finish=Te()((new Date).setTime(new Date(this.itemToSubmit.date_start).getTime()+60*Ee*60*1e3)).format("YYYY-MM-DD HH:mm:ss")),s=[],this.smsObj["1hour"]&&s.push(this.dateStartSubtractHours(1)),this.smsObj["3hours"]&&s.push(this.dateStartSubtractHours(3)),this.itemToSubmit.sms_send_time=s,a=new FormData,a.append("restaurant_id","2"),a.append("client_id",this.itemToSubmit.client_id),a.append("persons_count",this.itemToSubmit.persons_count||""),a.append("prepayment",this.itemToSubmit.prepayment?this.itemToSubmit.prepayment+" "+this.itemToSubmit.currency:""),a.append("date_start",this.itemToSubmit.date_start),a.append("date_finish",this.itemToSubmit.date_finish),a.append("options",this.computedOptions),a.append("comment",this.itemToSubmit.comment||""),a.append("event_id",this.itemToSubmit.event_id),a.append("image",this.itemToSubmit.image||""),a.append("from_mobile","0"),this.itemToSubmit.tables.length)for(i=0;i<this.itemToSubmit.tables.length;i++)a.append("tables["+i+"]",this.itemToSubmit.tables[i].id);else this.itemToSubmit.tables.id&&a.append("tables[0]",this.itemToSubmit.tables.id);if(this.itemToSubmit.sms_send_time.length)for(n=0;n<this.itemToSubmit.sms_send_time.length;n++)a.append("sms_send_time["+n+"]",this.itemToSubmit.sms_send_time[n]);if("edit"!==this.type){e.next=31;break}return e.next=28,this.editReserve(a);case 28:r=e.sent,e.next=34;break;case 31:return e.next=33,this.createReserve(a);case 33:r=e.sent;case 34:r&&r.data&&!0===r.data.success&&(this.$emit("itemSubmitSuccess",this.itemToSubmit),this.$store.dispatch("getReservesFromApp"));case 35:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),userWithEmailAndPhone:function(e){return e.last_name?e.email?e.name+" "+e.last_name+" — "+e.email+" — "+e.phone:e.name+" "+e.last_name+" — "+e.phone:e.email?e.name+" — "+e.email+" — "+e.phone:e.name+" — "+e.phone},searchUser:function(e){this.searchQuery=e,this.getClients()},previewImage:function(e){var t=this,s=e.target;if(s.files&&s.files[0]){var a=new FileReader;a.onload=function(e){t.imageData=e.target.result,t.show=!!t.imageData},a.readAsDataURL(s.files[0])}this.reserveObj.image=this.$refs.file.files[0]},deleteImage:function(){this.reserveObj.image=null,this.imageData="",this.show=!1,this.$refs.file.value=""},editClient:function(){var e=this;this.$http.put(Q.client+"/"+this.clientObj.id,{name:this.clientObj.name,last_name:this.clientObj.last_name,email:this.clientObj.email,birthday:this.clientObj.birthday,phone:this.clientObj.phone,comment:this.clientObj.comment,image:this.clientObj.image}).then(function(t){t&&t.data.data&&(e.showeditClient=!e.showeditClient,e.typeClient="edit",e.getClients())}).catch(function(t){e.handleFormValidationErrors(t,e.$refs.form)})},creatNewClient:function(){var e=this;this.$http.post(Q.client,{name:this.clientObj.name,last_name:this.clientObj.last_name,email:this.clientObj.email,birthday:this.clientObj.birthday,phone:this.clientObj.phone,comment:this.clientObj.comment,image:this.clientObj.image}).then(function(t){t&&t.data.data&&(e.clientObj.id=t.data.data.id,e.showeditClient=!e.showeditClient,e.typeClient="edit",e.getClients())}).catch(function(t){e.handleFormValidationErrors(t,e.$refs.form)})},showCreateClient:function(){this.typeClient="create",this.clientObj={name:"",last_name:"",email:"",birthday:"",phone:"",comment:"",image:"",avg_check:""},this.showeditClient=!this.showeditClient},closeEditClient:function(){this.clientObj.id||(this.clientObj=null),this.showeditClient=!this.showeditClient},addTables:function(){this.addingTables=!0,this.tableBackup=[].concat(this.reserveObj.tables)},cancelAddTables:function(){this.reserveObj.tables=[].concat(this.tableBackup),this.addingTables=!1},dateStartSubtractHours:function(e){return Te()((new Date).setTime(new Date(this.itemToSubmit.date_start).getTime()-60*e*60*1e3)).format("YYYY-MM-DD HH:mm:ss")}},mounted:function(){var e=this;if(this.reserveObj=Object.assign({},this.reserve),this.itemToSubmit.date_start=this.reserveObj.date_start,this.reserve.smses&&this.reserve.smses.length&&this.reserve.smses.forEach(function(t){e.dateStartSubtractHours(1)===Te()(t.send_time).format("YYYY-MM-DD HH:mm:ss")&&(e.smsObj["1hour"]=!0),e.dateStartSubtractHours(3)===Te()(t.send_time).format("YYYY-MM-DD HH:mm:ss")&&(e.smsObj["3hours"]=!0)}),"booking"===this.mode&&(this.day=this.reserveObj.date_start.slice(0,10),this.reserveObj.date_start=this.reserveObj.date_start.slice(11,this.reserveObj.date_start.length-3),this.reserveObj.date_finish=this.reserveObj.date_finish.slice(11,this.reserveObj.date_finish.length-3)),"string"===typeof this.reserveObj.options?this.reserveObj.options=this.reserveObj.options.split(", "):this.reserveObj.options=[],this.reserveObj.image_url&&(this.imageData=this.reserveObj.image_url,this.show=!0),this.reserve.prepayment){var t=this.reserve.prepayment.split(" ");this.reserveObj.prepayment=t[0],this.reserveObj.currency=t[1]}this.reserve.client&&(this.clientObj=this.reserve.client),Promise.all([this.getClients(),this.getTables(),this.getFutureEvents()]).then(this.addWatcher("reserveObj"))}},Ie=Fe,Re=Object(v["a"])(Ie,$e,Me,!1,null,null,null),Le=Re.exports,Ae=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",["create"===e.type?s("h2",{staticClass:"section__title"},[e._v("Создать расстановку столов")]):e._e(),"edit"===e.type?s("h2",{staticClass:"modal__title"},[e._v("Редактировать расстановку столов: "+e._s(e.tablePresetObj.name))]):e._e(),s("div",[s("form",{ref:"form",staticClass:"form",on:{submit:function(t){return t.preventDefault(),e.submitReserve(t)}}},[s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"name"}},[e._v("Название")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.tablePresetObj.name,expression:"tablePresetObj.name"}],attrs:{id:"name",type:"text"},domProps:{value:e.tablePresetObj.name},on:{input:function(t){t.target.composing||e.$set(e.tablePresetObj,"name",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"comment"}},[e._v("Комментарий")]),s("div",{staticClass:"input-item"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.tablePresetObj.comment,expression:"tablePresetObj.comment"}],attrs:{id:"comment",type:"text"},domProps:{value:e.tablePresetObj.comment},on:{input:function(t){t.target.composing||e.$set(e.tablePresetObj,"comment",t.target.value)}}})])]),s("div",{staticClass:"site-input"},[s("multiselect",{attrs:{options:e.restaurantSpaces,searchable:!0,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите зал",multiple:!1,trackBy:"id",label:"name",selectLabel:"Выбрать",deselectLabel:"",selectedLabel:"Выбрано"},model:{value:e.tablePresetObj.restaurant_space,callback:function(t){e.$set(e.tablePresetObj,"restaurant_space",t)},expression:"tablePresetObj.restaurant_space"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("По вашему запросу нет результатов.")])])],1),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"prepayment"}},[e._v("Масштаб столов")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.tablePresetObj.scale,expression:"tablePresetObj.scale"}],attrs:{id:"prepayment",type:"range",min:"0.5",max:"5",step:"0.1"},domProps:{value:e.tablePresetObj.scale},on:{__r:function(t){return e.$set(e.tablePresetObj,"scale",t.target.value)}}})])]),s("div",{staticClass:"site-input preset__checkbox"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.tablePresetObj.default,expression:"tablePresetObj.default"}],attrs:{type:"checkbox",id:"checkbox"},domProps:{checked:Array.isArray(e.tablePresetObj.default)?e._i(e.tablePresetObj.default,null)>-1:e.tablePresetObj.default},on:{change:function(t){var s=e.tablePresetObj.default,a=t.target,i=!!a.checked;if(Array.isArray(s)){var n=null,r=e._i(s,n);a.checked?r<0&&e.$set(e.tablePresetObj,"default",s.concat([n])):r>-1&&e.$set(e.tablePresetObj,"default",s.slice(0,r).concat(s.slice(r+1)))}else e.$set(e.tablePresetObj,"default",i)}}}),s("label",{attrs:{for:"checkbox"}},[e._v("Использовать данную расстановку по умолчанию")])]),e.tablePresetObj["restaurant_space"]?s("div",[s("h4",[e._v("Расстановка:")]),s("h5",[e._v("(Масштаб столов: "+e._s(e.tablePresetObj.scale)+")")]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.movingTable,expression:"movingTable"}],staticClass:"moving-message"},[e._v("\n                        Кликните по нужному месту на схеме для перемещения туда стола или введите точные координаты.\n                        "),s("button",{staticClass:"btn btn_danger",on:{click:function(t){t.stopPropagation(),t.preventDefault(),e.movingTable=!1}}},[e._v("Выйти из режима перемещения стола")])]),s("div",{ref:"preset",staticClass:"preset",class:{moving:e.movingTable},style:{background:"url("+e.tablePresetObj["restaurant_space"].image_url+") center center / 100% 100% no-repeat",width:e.tablePresetObj["restaurant_space"]["size_x"]+"px",height:e.tablePresetObj["restaurant_space"]["size_y"]+"px"},on:{click:function(t){return t.target!==t.currentTarget?null:(t.preventDefault(),e.openPresetMenu(t))}}},[s("div",{ref:"clickZone",staticClass:"preset__click-zone"}),e._l(e.tablePresetObj["tables"],function(t,a){return s("div",{key:a,staticClass:"preset__table",class:{selected:e.showTableMenu===t.id},style:{top:t["pivot"]["coord_y"]+"px",left:t["pivot"]["coord_x"]+"px",background:"url("+t.image_url+") center center / 100% 100% no-repeat",height:t.seats_count*e.tableScale+"px","min-height":"30px",width:t.seats_count*e.tableScale+"px","min-width":"30px","margin-top":-t.seats_count*e.tableScale/2+"px","margin-left":-t.seats_count*e.tableScale/2+"px"},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),e.openTableMenu(s,t)}}},[s("span",{staticClass:"name"},[e._v(e._s(t.name))]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.showTableMenu===t.id,expression:"showTableMenu === table.id"}],staticClass:"menu",style:{top:e.tableMenuY+"px",left:e.tableMenuX+"px"}},[s("span",{staticClass:"menu__option",on:{click:function(s){return e.openMoveTable(t)}}},[e._v("Переместить стол")]),s("span",{staticClass:"menu__option",on:{click:function(s){return e.openDeleteTable(t)}}},[e._v("Удалить стол")])]),e.movingTable&&e.tableToMove.id===t.id?s("div",{staticClass:"coordinates"},[s("div",{staticClass:"coordinates__row"},[s("label",{attrs:{for:"move-x"}},[e._v("X:")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.tableToMove.pivot.coord_x,expression:"tableToMove.pivot.coord_x"}],attrs:{id:"move-x",type:"number"},domProps:{value:e.tableToMove.pivot.coord_x},on:{input:function(t){t.target.composing||e.$set(e.tableToMove.pivot,"coord_x",t.target.value)}}})]),s("div",{staticClass:"coordinates__row"},[s("label",{attrs:{for:"move-y"}},[e._v("Y:")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.tableToMove.pivot.coord_y,expression:"tableToMove.pivot.coord_y"}],attrs:{id:"move-y",type:"number"},domProps:{value:e.tableToMove.pivot.coord_y},on:{input:function(t){t.target.composing||e.$set(e.tableToMove.pivot,"coord_y",t.target.value)}}})]),s("div",{staticClass:"coordinates__save",on:{click:e.confirmTableMove}},[s("span",[e._v("✔")])])]):e._e()])}),s("div",{directives:[{name:"show",rawName:"v-show",value:e.showPresetMenu,expression:"showPresetMenu"}],staticClass:"menu menu_btlr",style:{top:e.presetMenuY+"px",left:e.presetMenuX+"px"}},[s("span",{staticClass:"menu__option",on:{click:e.openAddTable}},[e._v("Добавить стол")])]),e.deletingTable?s("div",{staticClass:"preset__delete-table"},[s("h4",[e._v("Удалить стол "+e._s(e.tableToDelete.name)+" ?")]),s("span",{staticClass:"close",on:{click:function(t){e.deletingTable=!1}}},[e._v("×")]),s("button",{staticClass:"btn btn_danger",on:{click:e.confirmDeleteTable}},[e._v("Удалить")])]):e._e(),e.showTableList?s("div",{staticClass:"preset__add-table"},[s("h4",[e._v("Добавить стол")]),s("span",{staticClass:"close",on:{click:function(t){e.showTableList=!1}}},[e._v("×")]),s("div",{staticClass:"tables-dropdown"},[s("div",{staticClass:"site-input"},[s("div",{staticClass:"input-item",attrs:{id:"status"}},[s("multiselect",{attrs:{options:e.tables,searchable:!0,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите стол",multiple:!1,trackBy:"id",label:"name",selectLabel:"Выбрать",deselectLabel:"Убрать",selectedLabel:"Выбрано"},scopedSlots:e._u([{key:"option",fn:function(t){return[s("img",{directives:[{name:"show",rawName:"v-show",value:t.option.image_url,expression:"props.option.image_url"}],staticClass:"option__image",attrs:{src:t.option.image_url,alt:t.option.name}}),s("div",{staticClass:"option__desc"},[s("span",{staticClass:"option__title"},[e._v(e._s(t.option.name)+" (мест: "+e._s(t.option.seats_count)+")")])])]}}],null,!1,83997009),model:{value:e.additionalTable,callback:function(t){e.additionalTable=t},expression:"additionalTable"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("По вашему запросу нет результатов.")])])],1)])]),s("button",{staticClass:"btn btn_success",attrs:{disabled:!e.additionalTable},on:{click:e.addTable}},[e._v("Добавить")])]):e._e()],2)]):e._e(),e._m(0)])])])},Ye=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"form__row"},[s("button",{staticClass:"btn btn_primary",attrs:{type:"submit"}},[e._v("Сохранить")])])}],Ne=(s("20d6"),{name:"TablePresetForm",components:{Multiselect:K.a},mixins:[ne],props:{type:{type:String,default:"create"},tablePreset:{type:Object,default:function(){return{comment:"",id:"",name:"",restaurant_space_id:"",scale:1,tables:[]}}}},data:function(){return{tablePresetObj:{},itemToSubmit:{},imageData:"",show:!1,showPresetMenu:!1,presetMenuX:0,presetMenuY:0,showTableMenu:null,tableMenuX:0,tableMenuY:0,showTableList:!1,additionalTable:null,tables:[],movingTable:!1,tableToMove:{pivot:{}},prevX:0,prevY:0,deletingTable:!1,tableToDelete:{},restaurantSpaces:[]}},computed:{tableScale:function(){return 5*parseFloat(this.tablePresetObj.scale)}},methods:{openPresetMenu:function(e){this.showTableMenu=!1;var t=e.target.getBoundingClientRect();this.presetMenuX=Math.floor(e.clientX-t.left),this.presetMenuY=Math.floor(e.clientY-t.top),this.showPresetMenu=!0},openAddTable:function(){this.getTables(),this.showTableList=!0},getTables:function(){var e=this;this.$http.get("/tables").then(function(t){t&&t.data&&t.data.data&&t.data.data.items&&(e.tables=t.data.data.items.map(function(t){return e.tablePresetObj.tables.find(function(e){return e.id===t.id})&&(t.$isDisabled=!0),t}))})},addTable:function(){this.additionalTable.pivot={coord_x:this.presetMenuX,coord_y:this.presetMenuY},this.tablePresetObj.tables.push(this.additionalTable),this.showTableList=!1},openDeleteTable:function(e){this.deletingTable=!0,this.tableToDelete=e},confirmDeleteTable:function(){var e=this;this.tablePresetObj.tables=this.tablePresetObj.tables.filter(function(t){return t.id!==e.tableToDelete.id}),this.deletingTable=!1},openMoveTable:function(e){var t=this;this.showTableList=!1,this.showTableMenu=!1,this.tableToMove=e,this.prevX=e.pivot.coord_x,this.prevY=e.pivot.coord_y,this.movingTable=!0,$(this.$refs.clickZone).on("click",function(e){e.target===t.$refs.clickZone&&t.moveTable(e)})},moveTable:function(e){var t=this,s=e.target.getBoundingClientRect();this.tableToMove.pivot.coord_x=Math.floor(e.clientX-s.left),this.tableToMove.pivot.coord_y=Math.floor(e.clientY-s.top),this.tablePresetObj.tables[this.tablePresetObj.tables.findIndex(function(e){return e.id===t.tableToMove.id})]=this.tableToMove},confirmTableMove:function(){var e=this;$(this.$refs.clickZone).off("click"),this.tablePresetObj.tables[this.tablePresetObj.tables.findIndex(function(t){return t.id===e.tableToMove.id})]=this.tableToMove,this.tableToMove={pivot:{}},this.movingTable=!1},cancelTableMove:function(){var e=this;$(this.$refs.clickZone).off("click"),this.tablePresetObj.tables[this.tablePresetObj.tables.findIndex(function(t){return t.id===e.tableToMove.id})].pivot.coord_x=this.prevX,this.tablePresetObj.tables[this.tablePresetObj.tables.findIndex(function(t){return t.id===e.tableToMove.id})].pivot.coord_y=this.prevY,this.tableToMove={pivot:{}},this.movingTable=!1},openTableMenu:function(e,t){this.showPresetMenu=!1;var s=e.target.getBoundingClientRect();this.tableMenuX=Math.floor(e.clientX-s.left),this.tableMenuY=Math.floor(e.clientY-s.top),this.showTableMenu=t.id},createItem:function(){var e=this;return this.$http.post(Q.tablePreset,this.itemToSubmit).then(function(e){return e}).catch(function(t){e.handleFormValidationErrors(t,e.$refs.form)})},editItem:function(){var e=this;return this.$http.post(Q.tablePreset+"/"+this.tablePresetObj.id,this.itemToSubmit).then(function(e){return e}).catch(function(t){e.handleFormValidationErrors(t,e.$refs.form)})},submitReserve:function(){var e=Object(se["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.itemToSubmit={scale:+this.tablePresetObj.scale,name:this.tablePresetObj.name,comment:this.tablePresetObj.comment,tables:this.tablePresetObj.tables.map(function(e){return{id:e.id,coord_x:e.pivot.coord_x,coord_y:e.pivot.coord_y}}),restaurant_space_id:this.tablePresetObj.restaurant_space.id,default:this.tablePresetObj.default},"edit"!==this.type){e.next=7;break}return e.next=4,this.editItem();case 4:t=e.sent,e.next=10;break;case 7:return e.next=9,this.createItem();case 9:t=e.sent;case 10:t&&t.data&&!0===t.data.success&&this.$emit("itemSubmitSuccess",this.itemToSubmit);case 11:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getRestaurantSpaces:function(){var e=this;this.$http.get(Q.restaurantSpace).then(function(t){t&&t.data&&t.data.data&&t.data.data.items&&(e.restaurantSpaces=t.data.data.items)})}},mounted:function(){var e=this;this.tablePresetObj=Object.assign({},this.tablePreset),$(window).on("click",function(t){var s=$(t.target),a=$(t.target.parentElement);if(!s.hasClass("preset")&&!s.parents(".preset").length)return e.showPresetMenu=!1,void(e.showTableMenu=!1);s.hasClass("preset__table")||a.hasClass("preset__table")?e.showPresetMenu=!1:e.showTableMenu=!1}),"create"===this.type&&this.getRestaurantSpaces(),this.addWatcher("tablePresetObj")},destroyed:function(){$(window).off("click")}}),Be=Ne,He=(s("11ed"),Object(v["a"])(Be,Ae,Ye,!1,null,null,null)),Ue=He.exports,ze=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",["create"===e.type?s("h2",{staticClass:"section__title"},[e._v("Создать расстановку столов")]):e._e(),"edit"===e.type?s("h2",{staticClass:"modal__title"},[e._v("Редактировать расстановку столов на "+e._s(e.tablePresetForDateObj.date?e.tablePresetForDateObj.date.slice(0,10):""))]):e._e(),s("div",[s("div",{staticClass:"pre-form"},[s("p",[e._v("На базе расстановки: "),s("b",[e._v(e._s(e.tablePresetForDateObj.table_preset.name))]),e._v(" |\n                "+e._s(e.tablePresetForDateObj.table_preset.comment))]),s("p",[e._v("Зал: "+e._s(e.tablePresetForDateObj.restaurant_space_id))])]),s("form",{ref:"form",staticClass:"form",on:{submit:function(t){return t.preventDefault(),e.submitReserve(t)}}},[s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"date_time"}},[e._v("Дата")]),s("div",{staticClass:"input-item"},[s("datepicker",{attrs:{id:"date_time",lang:"ru",appendToBody:!1,format:"YYYY-MM-DD","first-day-of-week":1,width:"auto",valueType:"format"},model:{value:e.tablePresetForDateObj.date,callback:function(t){e.$set(e.tablePresetForDateObj,"date",t)},expression:"tablePresetForDateObj.date"}})],1)]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"table_preset_id"}},[e._v("Выбрать другой шаблон расстановки")]),s("div",{staticClass:"input-item",attrs:{id:"table_preset_id"}},[s("multiselect",{attrs:{options:e.tablePresets,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите расстановку",multiple:!1,trackBy:"id",label:"name",selectLabel:"Выбрать",deselectLabel:"Убрать",selectedLabel:"Выбрано"},model:{value:e.tablePresetForDateObj.table_preset,callback:function(t){e.$set(e.tablePresetForDateObj,"table_preset",t)},expression:"tablePresetForDateObj.table_preset"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("По вашему запросу нет результатов.")])])],1)]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"day_description"}},[e._v("Описание дня")]),s("div",{staticClass:"input-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.tablePresetForDateObj.day_description,expression:"tablePresetForDateObj.day_description"}],attrs:{id:"day_description",type:"text",required:""},domProps:{value:e.tablePresetForDateObj.day_description},on:{input:function(t){t.target.composing||e.$set(e.tablePresetForDateObj,"day_description",t.target.value)}}})])]),e.tablePresetForDateObj.table_preset["restaurant_space"]?s("div",[s("h4",[e._v("Расстановка:")]),s("h5",[e._v("(Масштаб столов: "+e._s(e.tablePresetForDateObj.table_preset.scale)+")")]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.movingTable,expression:"movingTable"}],staticClass:"moving-message"},[e._v("\n                    Кликните по нужному месту на схеме для перемещения туда стола или введите точные координаты.\n                    "),s("button",{staticClass:"btn btn_danger",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.cancelTableMove(t)}}},[e._v("Выйти из режима перемещения стола")])]),s("div",{ref:"preset",staticClass:"preset",class:{moving:e.movingTable},style:{background:"url("+e.tablePresetForDateObj.table_preset["restaurant_space"].image_url+") center center / 100% 100% no-repeat",width:e.tablePresetForDateObj.table_preset["restaurant_space"]["size_x"]+"px",height:e.tablePresetForDateObj.table_preset["restaurant_space"]["size_y"]+"px"},on:{click:function(t){return t.target!==t.currentTarget?null:(t.preventDefault(),e.openPresetMenu(t))}}},[s("div",{ref:"clickZone",staticClass:"preset__click-zone"}),e._l(e.tablePresetForDateObj.table_preset["tables"],function(t,a){return s("div",{key:a,staticClass:"preset__table",class:{selected:e.showTableMenu===t.id},style:{top:t["pivot"]["coord_y"]+"px",left:t["pivot"]["coord_x"]+"px",background:"url("+t.image_url+") center center / 100% 100% no-repeat",height:t.seats_count*e.tableScale+"px","min-height":"30px",width:t.seats_count*e.tableScale+"px","min-width":"30px","margin-top":-t.seats_count*e.tableScale/2+"px","margin-left":-t.seats_count*e.tableScale/2+"px"}},[s("span",{staticClass:"name"},[e._v(e._s(t.name))])])}),e._l(e.tablePresetForDateObj["additional_tables"],function(t,a){return s("div",{key:"a"+a,staticClass:"preset__table additional",class:{selected:e.showTableMenu===t.id,movable:e.tableToMove.id===t.id},style:{top:t["pivot"]["coord_y"]+"px",left:t["pivot"]["coord_x"]+"px",background:"url("+t.image_url+") center center / 100% 100% no-repeat",height:t.seats_count*e.tableScale+"px","min-height":"30px",width:t.seats_count*e.tableScale+"px","min-width":"30px","margin-top":-t.seats_count*e.tableScale/2+"px","margin-left":-t.seats_count*e.tableScale/2+"px"},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),e.openTableMenu(s,t)}}},[s("span",{staticClass:"name"},[e._v(e._s(t.name))]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.showTableMenu===t.id,expression:"showTableMenu === table.id"}],staticClass:"menu",style:{top:e.tableMenuY+"px",left:e.tableMenuX+"px"}},[s("span",{staticClass:"menu__option",on:{click:function(s){return s.stopPropagation(),e.openMoveTable(t)}}},[e._v("Переместить стол")]),s("span",{staticClass:"menu__option",on:{click:function(s){return s.stopPropagation(),e.openDeleteTable(t)}}},[e._v("Удалить стол")])]),e.movingTable&&e.tableToMove.id===t.id?s("div",{staticClass:"coordinates"},[s("div",{staticClass:"coordinates__row"},[s("label",{attrs:{for:"move-x"}},[e._v("X:")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.tableToMove.pivot.coord_x,expression:"tableToMove.pivot.coord_x"}],attrs:{id:"move-x",type:"number"},domProps:{value:e.tableToMove.pivot.coord_x},on:{input:function(t){t.target.composing||e.$set(e.tableToMove.pivot,"coord_x",t.target.value)}}})]),s("div",{staticClass:"coordinates__row"},[s("label",{attrs:{for:"move-y"}},[e._v("Y:")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.tableToMove.pivot.coord_y,expression:"tableToMove.pivot.coord_y"}],attrs:{id:"move-y",type:"number"},domProps:{value:e.tableToMove.pivot.coord_y},on:{input:function(t){t.target.composing||e.$set(e.tableToMove.pivot,"coord_y",t.target.value)}}})]),s("div",{staticClass:"coordinates__save",on:{click:e.confirmTableMove}},[s("span",[e._v("✔")])])]):e._e()])}),s("div",{directives:[{name:"show",rawName:"v-show",value:e.showPresetMenu,expression:"showPresetMenu"}],staticClass:"menu menu_btlr",style:{top:e.presetMenuY+"px",left:e.presetMenuX+"px"}},[s("span",{staticClass:"menu__option",on:{click:e.openAddTable}},[e._v("Добавить стол")])]),e.deletingTable?s("div",{staticClass:"preset__delete-table"},[s("h4",[e._v("Удалить стол "+e._s(e.tableToDelete.name)+" ?")]),s("span",{staticClass:"close",on:{click:function(t){e.deletingTable=!1}}},[e._v("×")]),s("button",{staticClass:"btn btn_danger",on:{click:e.confirmDeleteTable}},[e._v("Удалить")])]):e._e(),e.showTableList?s("div",{staticClass:"preset__add-table"},[s("h4",[e._v("Добавить стол")]),s("span",{staticClass:"close",on:{click:function(t){e.showTableList=!1}}},[e._v("×")]),s("div",{staticClass:"tables-dropdown"},[s("div",{staticClass:"site-input"},[s("div",{staticClass:"input-item",attrs:{id:"status"}},[s("multiselect",{attrs:{options:e.tables,searchable:!0,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите стол",multiple:!1,trackBy:"id",label:"name",selectLabel:"Выбрать",deselectLabel:"Убрать",selectedLabel:"Выбрано"},scopedSlots:e._u([{key:"option",fn:function(t){return[s("img",{directives:[{name:"show",rawName:"v-show",value:t.option.image_url,expression:"props.option.image_url"}],staticClass:"option__image",attrs:{src:t.option.image_url,alt:"No Man’s Sky"}}),s("div",{staticClass:"option__desc"},[s("span",{staticClass:"option__title"},[e._v(e._s(t.option.name)+" (мест: "+e._s(t.option.seats_count)+")")])])]}}],null,!1,1354786963),model:{value:e.additionalTable,callback:function(t){e.additionalTable=t},expression:"additionalTable"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("По вашему запросу нет результатов.")])])],1)])]),s("button",{staticClass:"btn btn_success",attrs:{disabled:!e.additionalTable},on:{click:e.addTable}},[e._v("Добавить")])]):e._e()],2)]):e._e(),e._m(0)])])])},qe=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"form__row"},[s("button",{staticClass:"btn btn_primary",attrs:{type:"submit"}},[e._v("Сохранить")])])}],Ve={name:"TablePresetForDateForm",components:{Multiselect:K.a,Datepicker:ie.a},mixins:[ne],props:{type:{type:String,default:"create"},tablePreset:{type:Object,default:function(){return{comment:"",id:"",name:"",restaurant_space_id:"",scale:1,tables:[]}}}},data:function(){return{tablePresetForDateObj:{table_preset:{},additional_tables:[]},itemToSubmit:{},imageData:"",show:!1,showPresetMenu:!1,presetMenuX:0,presetMenuY:0,showTableMenu:null,tableMenuX:0,tableMenuY:0,showTableList:!1,additionalTable:null,tables:[],movingTable:!1,tableToMove:{pivot:{}},prevX:0,prevY:0,deletingTable:!1,tableToDelete:{},restaurantSpaces:[],tablePresets:[],datePreset:""}},computed:{tableScale:function(){return 5*parseFloat(this.tablePresetForDateObj.table_preset?this.tablePresetForDateObj.table_preset.scale:this.tablePresetForDateObj.scale)}},methods:{openPresetMenu:function(e){this.showTableMenu=!1;var t=e.target.getBoundingClientRect();this.presetMenuX=Math.floor(e.clientX-t.left),this.presetMenuY=Math.floor(e.clientY-t.top),this.showPresetMenu=!0},openAddTable:function(){this.getTables(),this.showTableList=!0},getTables:function(){var e=this;this.$http.get("/available_tables_for_add_additional/"+this.tablePresetForDateObj.restaurant_space_id+"/"+this.tablePresetForDateObj.date).then(function(t){if(t&&t.data&&t.data.data){var s=e.tablePresetForDateObj.table_preset.tables.concat(e.tablePresetForDateObj.additional_tables);e.tables=t.data.data.map(function(e){return s.find(function(t){return t.id===e.id})&&(e.$isDisabled=!0),e})}})},addTable:function(){this.additionalTable.pivot={coord_x:this.presetMenuX,coord_y:this.presetMenuY},this.tablePresetForDateObj.additional_tables.push(this.additionalTable),this.showTableList=!1},openDeleteTable:function(e){this.deletingTable=!0,this.tableToDelete=e},confirmDeleteTable:function(){var e=this;this.tablePresetForDateObj.additional_tables=this.tablePresetForDateObj.additional_tables.filter(function(t){return t.id!==e.tableToDelete.id}),this.deletingTable=!1},openMoveTable:function(e){var t=this;this.showTableList=!1,this.showTableMenu=!1,this.tableToMove=e,this.prevX=e.pivot.coord_x,this.prevY=e.pivot.coord_y,this.movingTable=!0,$(this.$refs.clickZone).on("click",function(e){e.target===t.$refs.clickZone&&t.moveTable(e)})},moveTable:function(e){var t=e.target.getBoundingClientRect();this.tableToMove.pivot.coord_x=Math.floor(e.clientX-t.left),this.tableToMove.pivot.coord_y=Math.floor(e.clientY-t.top)},confirmTableMove:function(){var e=this;$(this.$refs.clickZone).off("click"),this.tablePresetForDateObj.additional_tables[this.tablePresetForDateObj.additional_tables.findIndex(function(t){return t.id===e.tableToMove.id})]=this.tableToMove,this.tableToMove={pivot:{}},this.movingTable=!1},cancelTableMove:function(){var e=this;$(this.$refs.clickZone).off("click"),this.tablePresetForDateObj.additional_tables[this.tablePresetForDateObj.additional_tables.findIndex(function(t){return t.id===e.tableToMove.id})].pivot.coord_x=this.prevX,this.tablePresetForDateObj.additional_tables[this.tablePresetForDateObj.additional_tables.findIndex(function(t){return t.id===e.tableToMove.id})].pivot.coord_y=this.prevY,this.tableToMove={pivot:{}},this.movingTable=!1},openTableMenu:function(e,t){this.showPresetMenu=!1;var s=e.target.getBoundingClientRect();this.tableMenuX=Math.floor(e.clientX-s.left),this.tableMenuY=Math.floor(e.clientY-s.top),this.showTableMenu=t.id},createItem:function(){var e=this;return this.$http.post(Q.tablesForDate,this.itemToSubmit).then(function(e){return e}).catch(function(t){e.handleFormValidationErrors(t,e.$refs.form)})},editItem:function(){var e=this;return this.$http.put(Q.tablesForDate+"/"+this.tablePresetForDateObj.id,this.itemToSubmit).then(function(e){return e}).catch(function(t){e.handleFormValidationErrors(t,e.$refs.form)})},submitReserve:function(){var e=Object(se["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.itemToSubmit={date:this.tablePresetForDateObj.date,day_description:this.tablePresetForDateObj.day_description,additional_tables:this.tablePresetForDateObj.additional_tables.map(function(e){return{id:e.id,coord_x:e.pivot.coord_x,coord_y:e.pivot.coord_y}}),table_preset_id:this.tablePresetForDateObj.table_preset.id,restaurant_space_id:this.tablePresetForDateObj.restaurant_space_id},"edit"!==this.type){e.next=7;break}return e.next=4,this.editItem();case 4:t=e.sent,e.next=10;break;case 7:return e.next=9,this.createItem();case 9:t=e.sent;case 10:t&&t.data&&!0===t.data.success&&this.$emit("itemSubmitSuccess",this.itemToSubmit);case 11:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getTablePresets:function(){var e=this;this.$http.get(Q.tablePreset).then(function(t){t&&t.data&&t.data.data&&t.data.data.items&&(e.tablePresets=t.data.data.items)})}},mounted:function(){var e=this;this.tablePresetForDateObj=Object.assign({},this.tablePreset),$(window).on("click",function(t){var s=$(t.target),a=$(t.target.parentElement);if(!s.hasClass("preset")&&!s.parents(".preset").length)return e.showPresetMenu=!1,void(e.showTableMenu=!1);s.hasClass("additional")||a.hasClass("additional")?e.showPresetMenu=!1:e.showTableMenu=!1}),this.getTablePresets(),this.addWatcher("tablePresetForDateObj")},destroyed:function(){$(window).off("click")}},Xe=Ve,Qe=Object(v["a"])(Xe,ze,qe,!1,null,null,null),We=Qe.exports,Ge=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"modal",class:{fade:!e.showItemPopup,open:e.showItemPopup,fullscreen:"tablePreset"===e.viewType||"tablesForDate"===e.viewType},on:{click:function(t){return t.target!==t.currentTarget?null:(t.stopPropagation(),e.close(t))}}},[s("div",{staticClass:"modal-dialog"},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-body"},[s("div",{staticClass:"popup__close",on:{click:e.close}},[e._v("×")]),s("h2",{staticClass:"popup__title"},["tablePreset"===e.viewType?s("span",[e._v(e._s(e.itemToShow.name))]):s("span",[e._v(e._s(e.itemToShow.id))])]),s("div",{staticClass:"popup__buttons"},[s("button",{staticClass:"btn btn_primary btn_mr",on:{click:function(t){return t.preventDefault(),e.editItem(e.itemToShow)}}},[e._v("Обновить")]),s("button",{staticClass:"btn btn_danger",on:{click:function(t){return t.preventDefault(),e.deleteItem(e.itemToShow)}}},[e._v("Удалить")])]),s("table",{staticClass:"table table-bordered"},[s("thead"),s("tbody",e._l(e.rows,function(t,a){return s("tr",{key:a},[e.headings[t]?s("th",[e._v(e._s(e.headings[t]))]):e._e(),e.headings[t]?s("td",["restaurant_space"===t?s("tr",[s("th",[e._v("Зал: ")]),s("td",[e._v(e._s(e.itemToShow[t].name))])]):e._e(),"restaurant_space"===t?s("tr",[s("th",[e._v("Описание зала: ")]),s("td",[e._v(e._s(e.itemToShow[t].description||""))])]):e._e(),"table_preset"===t?s("tr",[s("th",[e._v("Название: ")]),s("td",[e._v(e._s(e.itemToShow.table_preset.name))])]):e._e(),"table_preset"===t?s("tr",[s("th",[e._v("Комментарий: ")]),s("td",[e._v(e._s(e.itemToShow.table_preset.comment))])]):e._e(),"table_preset"===t?s("tr",[s("th",[e._v("Зал: ")]),s("td",[e._v(e._s(e.itemToShow.table_preset["restaurant_space"].name))])]):e._e(),s("tr","table_preset"===t?[s("th",[e._v("Описание зала: ")]),s("td",[e._v(e._s(e.itemToShow.table_preset["restaurant_space"].description))])]:"image_url"===t?[s("td",[s("img",{staticClass:"item-image",attrs:{src:e.itemToShow[t],alt:""}})])]:["string"===typeof e.itemToShow[t]||"number"===typeof e.itemToShow[t]?s("td",[e._v(e._s(e.itemToShow[t]))]):e._e()])]):e._e()])}),0)]),e.itemToShow["restaurant_space"]?s("div",[s("h4",[e._v("Расстановка:")]),"tablePreset"===e.viewType?s("h5",[e._v("(Масштаб столов: "+e._s(e.itemToShow.scale)+")")]):e._e(),"tablesForDate"===e.viewType?s("h5",[e._v("(Масштаб столов: "+e._s(e.itemToShow.table_preset.scale)+")")]):e._e(),s("div",{staticClass:"preset",style:{background:"url("+e.itemToShow["restaurant_space"].image_url+") center center / 100% 100% no-repeat",width:e.itemToShow["restaurant_space"]["size_x"]+"px",height:e.itemToShow["restaurant_space"]["size_y"]+"px"}},e._l(e.itemToShow["tables"],function(t,a){return s("div",{key:a,staticClass:"preset__table",style:{top:t["pivot"]["coord_y"]+"px",left:t["pivot"]["coord_x"]+"px",background:"url("+t.image_url+") center center / 100% 100% no-repeat",height:t.seats_count*e.tableScale+"px","min-height":"30px",width:t.seats_count*e.tableScale+"px","min-width":"30px","margin-top":-t.seats_count*e.tableScale/2+"px","margin-left":-t.seats_count*e.tableScale/2+"px"}},[s("span",{staticClass:"name"},[e._v(e._s(t.name))])])}),0)]):e._e(),e.itemToShow.table_preset&&e.itemToShow.table_preset["restaurant_space"]?s("div",[s("h4",[e._v("Расстановка:")]),s("h5",[e._v("(Масштаб столов: "+e._s(e.itemToShow.table_preset.scale)+")")]),s("div",{staticClass:"preset",style:{background:"url("+e.itemToShow.table_preset["restaurant_space"].image_url+") center center / 100% 100% no-repeat",width:e.itemToShow.table_preset["restaurant_space"]["size_x"]+"px",height:e.itemToShow.table_preset["restaurant_space"]["size_y"]+"px"}},[e._l(e.itemToShow.table_preset["tables"],function(t,a){return s("div",{key:a,staticClass:"preset__table",style:{top:t["pivot"]["coord_y"]+"px",left:t["pivot"]["coord_x"]+"px",background:"url("+t.image_url+") center center / 100% 100% no-repeat",height:t.seats_count*e.tableScale+"px","min-height":"30px",width:t.seats_count*e.tableScale+"px","min-width":"30px","margin-top":-t.seats_count*e.tableScale/2+"px","margin-left":-t.seats_count*e.tableScale/2+"px"}},[s("span",{staticClass:"name"},[e._v(e._s(t.name))])])}),e._l(e.itemToShow.additional_tables,function(t,a){return s("div",{key:"a"+a,staticClass:"preset__table additional",style:{top:t["pivot"]["coord_y"]+"px",left:t["pivot"]["coord_x"]+"px",background:"url("+t.image_url+") center center / 100% 100% no-repeat",height:t.seats_count*e.tableScale+"px","min-height":"30px",width:t.seats_count*e.tableScale+"px","min-width":"30px","margin-top":-t.seats_count*e.tableScale/2+"px","margin-left":-t.seats_count*e.tableScale/2+"px"}},[s("span",{staticClass:"name"},[e._v(e._s(t.name))])])})],2)]):e._e()])])])])},Ze=[],Je={name:"ItemViewModal",props:["showItemPopup","columns","headings","itemToShow","viewType","editItem","deleteItem","close"],computed:{rows:function(){return Object.keys(this.itemToShow)},tableScale:function(){return 5*parseFloat(this.itemToShow.table_preset?this.itemToShow.table_preset.scale:this.itemToShow.scale||1)}}},Ke=Je,et=Object(v["a"])(Ke,Ge,Ze,!1,null,null,null),tt=et.exports;function st(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,a)}return s}function at(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?st(s,!0).forEach(function(t){Object(l["a"])(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):st(s).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}var it=function(e){var t={};for(var s in e)e.hasOwnProperty(s)&&(t[e[s]]="");return t},nt={name:"DataTable",props:["options"],components:{UserForm:ce,TableForm:he,EventForm:Ce,ReserveForm:De,ReserveFromAppForm:Le,TablePresetForm:Ue,TablePresetForDateForm:We,ItemViewModal:tt,Pagination:Z.a,Multiselect:K.a},data:function(){return{tableData:[],searchQueryString:"",prefetchDataList:this.options.prefetchDataList||[],actions:this.options.actions||[],tableOptions:{preserveState:!0,theme:"bootstrap3",template:"default",filterable:!1,headings:this.options.headings,sortable:this.options.sortable||[],perPage:20,texts:{noResults:"Нет результатов",loading:"Загрузка..."},templates:this.options.templates},columns:this.options.columns,formatted:this.options.formatted||null,pagination:{page:1,records:0,perPage:20,totalPages:0},paginationOptions:{format:!0,chunk:10,chunksNavigation:"fixed",edgeNavigation:!0,theme:"bootstrap4",texts:{count:"Показаны записи с {from} по {to} из {count}.",first:"На первую",last:"На последнюю"}},searchObject:{},searchObjectWatcher:null,searchQueryTimeout:null,searchQueryObject:{},showItemPopup:!1,viewType:"",itemToShow:{},showItemEditPopup:!1,itemToEdit:{},showItemDeletePopup:!1,itemToDelete:{},itemIsChanged:!1,confirmClose:!1,reasonForRemoval:"",typeForm:!1,reserveOptions:["Все","Прошедшие","Будущие"],selectedReserveOptions:""}},computed:{params:function(){return{page:this.pagination.page||1}}},methods:{getDataOnActivated:function(){var e=this;this.prefetchDataList.length?Promise.all(this.prefetchDataList.map(function(t){return e.$store.dispatch("getDataList",t)})).then(function(){e.getData()}):this.getData()},getData:function(){var e=this,t=this.params;this.options.getDataParams&&(t=Object.assign(t,this.options.getDataParams)),this.options.searchParams&&this.options.searchParams.length&&this.options.searchParams.forEach(function(s){t[s]=e.searchObject[s]}),this.$http.get(this.searchQueryString.length?Q[this.options.type]+"?search="+this.searchQueryString:Q[this.options.type],{params:t}).then(function(t){var s=t.data.data.items;e.formatted?e.tableData=s.map(function(t){return Object.keys(e.formatted).forEach(function(s){t[s]=e.formatted[s](t[s])}),t}):e.tableData=s,e.$store.state.itemToEdit&&e.$store.state.itemToEdit.type===e.options.type&&("last"===e.$store.state.itemToEdit.id?e.editItem(e.tableData[e.tableData.length-1]):e.editItem(e.tableData.find(function(t){return t.id===e.$store.state.itemToEdit.id}))),e.$store.dispatch("setItemToEdit",null),e.pagination.page=parseFloat(t.data.data.page),e.pagination.records=t.data.data.records,e.pagination.perPage=t.data.data.perPage,e.pagination.totalPages=t.data.data.totalPages})},paginate:function(e){this.pagination.page=e,this.getData()},debounceSearch:function(e,t){var s=this;this.searchQueryTimeout&&clearTimeout(this.searchQueryTimeout),this.searchQueryTimeout=setTimeout(function(){s.searchObject[t]=e,s.searchQueryTimeout=null},600)},showItem:function(e){"tablePreset"===this.options.type||"tablesForDate"===this.options.type?this.viewType=this.options.type:this.viewType="",this.itemToShow=e,this.showItemPopup=!0},editItem:function(e,t){this.showItemPopup=!1,this.itemToEdit=e,this.showItemEditPopup=!0,this.typeForm="edit"!==t},deleteItem:function(e){this.showItemPopup=!1,this.itemToDelete=e,this.showItemDeletePopup=!0},deleteConfirmed:function(e){var t=this;if("reserve"===this.options.type){var s=new FormData;s.append("restaurant_id","2"),s.append("client_id",e.client_id);for(var a=0;a<e.tables.length;a++)s.append("tables["+a+"]",e.tables[a].id);s.append("persons_count",e.persons_count),s.append("prepayment",e.prepayment),s.append("date_start",e.date_start),s.append("date_finish",e.date_finish),s.append("options",e.options),s.append("comment",e.comment+" ПРИЧИНА УДАЛЕНИЯ: "+this.reasonForRemoval),s.append("event_id",e.event_id||""),s.append("image",e.image||""),this.$http.post(Q[this.options.type]+"/"+e.id,s,{headers:{"Content-Type":"multipart/form-data"}}).then(function(s){s.data&&!0===s.data.success&&t.$http.delete(Q[t.options.type]+"/"+e.id).then(function(e){t.showItemDeletePopup=!1,e.data&&!0===e.data.success&&t.getData()}).catch(function(e){return console.log(e)})}).catch(function(e){return console.log(e)})}else this.$http.delete(Q[this.options.type]+"/"+e.id).then(function(e){t.showItemDeletePopup=!1,e.data&&!0===e.data.success&&t.getData()}).catch(function(e){return console.log(e)})},closeItemPopup:function(){this.showItemPopup=!1},closeItemEditPopup:function(){this.itemIsChanged?this.confirmClose=!0:(this.showItemEditPopup=!1,this.itemIsChanged=!1)},closeItemEditPopupConfirme:function(){this.showItemEditPopup=!1,this.itemIsChanged=!1,this.confirmClose=!1},closeItemEditPopupCancel:function(){this.confirmClose=!1},onItemEditSuccess:function(){this.getData(),this.showItemEditPopup=!1},submitForm:function(e){var t=this;this.$http.post(Q[this.options.type]+"/"+e.id).then(function(e){t.showItemEditPopup=!1,t.itemIsChanged=!1,e.data&&!0===e.data.success&&t.getData()})},onItemChanged:function(e){this.itemToEdit=e,this.itemIsChanged=!0},changeOrderBy:function(e){this.options.getDataParams.orderBy=e,"desc"===this.options.getDataParams.sortedBy?this.options.getDataParams.sortedBy="asc":this.options.getDataParams.sortedBy="desc",this.getData()}},activated:function(){this.getDataOnActivated()},watch:{selectedReserveOptions:{handler:function(e){switch(e){case"Все":this.options.getDataParams.past="",this.getData();break;case"Прошедшие":this.options.getDataParams.past=!0,this.getData();break;case"Будущие":this.options.getDataParams.past=!1,this.getData();break;default:this.options.getDataParams.past="",this.getData()}}}},mounted:function(){var e=this;this.searchObject=it(at({},this.options.filterable)),this.$on("showItem",function(t){e.showItem(t)}),this.searchObjectWatcher=this.$watch("searchObject",{handler:function(e){for(var t in this.searchQueryObject={},this.searchQueryString="",e)e.hasOwnProperty(t)&&(this.searchQueryObject[t]=e[t],e[t].length&&(this.searchQueryString.length&&(this.searchQueryString+=";"),this.searchQueryString=this.searchQueryString.concat(t+":"+e[t])));this.getData()},deep:!0})}},rt=nt,ot=Object(v["a"])(rt,q,V,!1,null,null,null),lt=ot.exports,ct={name:"TablePresetsSaved",components:{DataTable:lt},data:function(){return{tableOptions:{type:"tablePreset",columns:["id","name","restaurant_space.name","edit"],filterable:["name","restaurant_space.name"],sortable:[],headings:{id:"#",name:"Название расстановки","restaurant_space.name":"Зал",edit:"Действия",restaurant_space:"Зал",comment:"Комментарий",created_at:"Создан",updated_at:"Обновлен"},prefetchDataList:[],actions:["view","edit","delete","copy"]}}}},ut=ct,dt=Object(v["a"])(ut,U,z,!1,null,null,null),mt=dt.exports,pt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"section table-presets-for-date"},[s("h2",{staticClass:"section__title"},[e._v("Расстановки столов: по датам")]),s("div",{staticClass:"get-data-param-select"},[s("div",{staticClass:"label"},[e._v("Отфильтровать для конкретного зала:")]),s("div",{staticClass:"site-input"},[s("multiselect",{attrs:{options:e.restaurantSpaces,searchable:!0,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите зал",multiple:!1,trackBy:"id",label:"name",selectLabel:"Выбрать",deselectLabel:"",selectedLabel:"Выбрано"},scopedSlots:e._u([{key:"option",fn:function(t){return[s("img",{directives:[{name:"show",rawName:"v-show",value:t.option.image_url,expression:"props.option.image_url"}],staticClass:"option__image",attrs:{src:t.option.image_url,alt:t.option.name}}),s("div",{staticClass:"option__desc"},[s("span",{staticClass:"option__title"},[e._v(e._s(t.option.name))])])]}}]),model:{value:e.selectedSpace,callback:function(t){e.selectedSpace=t},expression:"selectedSpace"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("По вашему запросу нет результатов.")])])],1)]),s("data-table",{ref:"table",attrs:{options:e.tableOptions}})],1)},bt=[],ht={name:"TablesForDate",components:{DataTable:lt,Multiselect:K.a},data:function(){return{restaurantSpacesLoaded:!1,selectedSpace:{},restaurantSpaces:[],tableOptions:{type:"tablesForDate",getDataParams:{restaurant_space_id:""},columns:["id","date","table_preset.name","edit"],filterable:["date"],sortable:[],headings:{id:"#",date:"Дата","table_preset.name":"На базе расстановки",edit:"Действия",table_preset:"На базе расстановки",day_description:"Описание дня",created_at:"Создан",updated_at:"Обновлен"},prefetchDataList:[],actions:["view","edit","delete","copy"]}}},methods:{getRestaurantSpaces:function(){var e=this;return this.$http.get(Q.restaurantSpace).then(function(t){e.restaurantSpaces=t.data.data.items}).catch(function(t){e.handleFormValidationErrors(t,e.$refs.form)})},getDataByRestSpaceId:function(e){this.tableOptions.getDataParams={restaurant_space_id:e},this.$refs.table.getData()}},watch:{selectedSpace:{handler:function(e){this.getDataByRestSpaceId(e.id)},deep:!0}},mounted:function(){this.getRestaurantSpaces()}},vt=ht,_t=Object(v["a"])(vt,pt,bt,!1,null,null,null),ft=_t.exports,gt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"section table-presets"},[s("table-preset-form",{attrs:{type:"create"},on:{itemSubmitSuccess:e.onItemSubmitSuccess}})],1)},jt=[],Ct={name:"TablePresetCreate",components:{TablePresetForm:Ue},data:function(){return{}},methods:{onItemSubmitSuccess:function(){this.$router.push("/table-presets")}}},Ot=Ct,yt=Object(v["a"])(Ot,gt,jt,!1,null,null,null),wt=yt.exports,Tt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"section events"},[s("h2",{staticClass:"section__title"},[e._v("События")]),s("div",{staticClass:"section__create-btn"},[s("router-link",{attrs:{to:"/events/create/"}},[s("button",{staticClass:"btn btn_success"},[e._v("Создать событие")])])],1),s("data-table",{ref:"table",attrs:{options:e.tableOptions}})],1)},kt=[],St={name:"Users",components:{DataTable:lt},data:function(){return{tableOptions:{type:"event",columns:["id","title","date_time","edit"],filterable:["title","date_time"],sortable:[],headings:{id:"#",title:"Название",date_time:"Дата",edit:"Действия",description:"Описание",ticket_price:"Цена билета",min_deposit:"Минимальный депозит",image_url:"Изображение"},prefetchDataList:[],actions:["view","edit","delete"]}}}},xt=St,Pt=Object(v["a"])(xt,Tt,kt,!1,null,null,null),Dt=Pt.exports,$t=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"section events"},[s("event-form",{attrs:{type:"create"},on:{itemSubmitSuccess:e.onEventSubmitSuccess}})],1)},Mt=[],Et={name:"EventCreate",components:{EventForm:Ce},methods:{onEventSubmitSuccess:function(){this.$router.push("/events")}}},Ft=Et,It=Object(v["a"])(Ft,$t,Mt,!1,null,null,null),Rt=It.exports,Lt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"section tables"},[s("h2",{staticClass:"section__title"},[e._v("Столы")]),s("div",{staticClass:"section__create-btn"},[s("router-link",{attrs:{to:"/tables/create/"}},[s("button",{staticClass:"btn btn_success btn_mr"},[e._v("Создать стол")])])],1),s("data-table",{ref:"table",attrs:{options:e.tableOptions}})],1)},At=[],Yt={name:"Tables",components:{DataTable:lt},data:function(){return{tableTypes:{},tableOptions:{type:"table",columns:["id","name","seats_count","edit"],filterable:["name","seats_count"],sortable:[],headings:{id:"#",name:"Название стола",seats_count:"Количество мест",edit:"Действия",image_url:"Изображение"},prefetchDataList:[],actions:["view","edit","delete"]}}},methods:{}},Nt=Yt,Bt=Object(v["a"])(Nt,Lt,At,!1,null,null,null),Ht=Bt.exports,Ut=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"section tables"},[s("table-form",{attrs:{type:"create"},on:{itemSubmitSuccess:e.onItemSubmitSuccess}})],1)},zt=[],qt={name:"UserCreate",components:{TableForm:he},methods:{onItemSubmitSuccess:function(){this.$router.push("/tables")}}},Vt=qt,Xt=Object(v["a"])(Vt,Ut,zt,!1,null,null,null),Qt=Xt.exports,Wt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"section booking"},[s("h2",{staticClass:"section__title",on:{click:e.getBooking}},[e._v("Букинг")]),s("div",{staticClass:"booking__wrap"},[s("div",{staticClass:"booking__left"},[s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"tables"}},[e._v("Зал")]),s("div",{staticClass:"input-item"},[s("multiselect",{attrs:{id:"tables",options:e.restaurantSpaces,searchable:!1,"close-on-select":!0,placeholder:"Выберите столы",multiple:!1,label:"name","track-by":"id",selectLabel:"Выбрать",deselectLabel:"Убрать",selectedLabel:"Выбрано"},on:{change:e.getBooking},model:{value:e.selectedSpace,callback:function(t){e.selectedSpace=t},expression:"selectedSpace"}})],1)]),s("div",{staticClass:"site-input"},[s("label",{attrs:{for:"date_time"}},[e._v("Дата")]),s("div",{staticClass:"input-item"},[s("datepicker",{attrs:{id:"date_time",lang:"ru",appendToBody:"",format:"YYYY-MM-DD","first-day-of-week":1,width:"auto",valueType:"format"},on:{change:e.getBooking},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1)]),e.loaded?s("div",{staticClass:"booking__comment"},[e.editComment?e._e():s("div",{staticClass:"booking__comment-text"},[e.booking.tablesForDate.day_description?s("span",[e._v(e._s(e.booking.tablesForDate.day_description))]):e._e(),e.booking.tablesForDate.day_description?e._e():s("span",[e._v("[описание дня будет здесь]")]),s("span",{on:{click:e.tryEditComment}},[s("i",{staticClass:"fas fa-pencil-alt"})])]),e.editComment?s("div",[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.booking.tablesForDate.day_description,expression:"booking.tablesForDate.day_description"}],domProps:{value:e.booking.tablesForDate.day_description},on:{input:function(t){t.target.composing||e.$set(e.booking.tablesForDate,"day_description",t.target.value)}}}),s("p",{staticClass:"btn btn_success",on:{click:function(t){return e.editTablePresetForDate({goToForm:!1})}}},[e._v("Сохранить")])]):e._e()]):e._e()]),s("div",{staticClass:"booking__center"},[s("h4",{staticClass:"booking__event-subtitle"},[e._v("События в этот день:")]),e.booking.events&&e.booking.events.length?s("div",e._l(e.booking.events,function(t,a){return s("div",{key:a,staticClass:"booking__event"},[s("div",{staticClass:"booking__event-img"},[s("img",{attrs:{src:t.image_url,alt:""}})]),s("div",{staticClass:"booking__event-content"},[s("div",{staticClass:"booking__event-title"},[s("h3",[e._v(e._s(t.title))])]),s("div",{staticClass:"booking__event-params"},[s("h4",[e._v("\n                                Цена билета:\n                                "),s("span",[e._v(e._s(t.ticket_price))])]),s("h4",[e._v("\n                                Минимальный депозит:\n                                "),s("span",[e._v(e._s(t.min_deposit))])])])])])}),0):e._e()]),s("div",{staticClass:"booking__right"},[s("div",{staticClass:"booking__overbookReserves"},e._l(e.overbookReserves,function(t,a){return s("div",{key:a,staticClass:"preset__table booked",class:{selected:e.showTableMenu===t.id,additional:t.additional,expired:e.isExpired(t),group:e.isInActiveGroup(t.group)},style:{"background-image":"none","box-shadow":"0 0 4px 4px "+e.getGroupColor(t.group)},on:{click:function(s){return e.editReserve(t)}}},[t.length?s("div",{staticClass:"preset__table-reserve-options"},e._l(e.getOptionsArr(t[0].options),function(t,a){return s("span",{key:a,staticClass:"option",class:t.class},[e._v(e._s(t.value))])}),0):e._e(),s("div",{staticClass:"table-content"},[s("div",{staticClass:"text-wrapper"},[s("div",{staticClass:"text"},[s("div",{key:a,staticClass:"preset__table-reserve",style:{height:100/t.length+"%",width:"80%"}},[s("div",{staticClass:"preset__table-reserve-text"},[s("span",[e._v(e._s(t.persons_count)+" чел. ")]),s("span",[e._v(e._s(e.moment(t.date_start).format("HH:mm"))+" - "+e._s(e.moment(t.date_finish).format("HH:mm"))+" ")]),s("span",[e._v(e._s(t.client.name)+" "+e._s(t.client.last_name))])])])])])])])}),0),s("div",{staticClass:"booking__createTablePreset",on:{click:function(t){return e.editTablePresetForDate({goToForm:!0})}}},[s("p",{staticClass:"btn btn_success"},[e._v("Изменить расстановку")])])])]),e.loaded?s("div",{staticClass:"book",class:{client:e.clientMode}},[s("div",{ref:"preset",staticClass:"preset preset_nm",style:{background:"url("+e.selectedSpace.image_url+") center center / 100% 100% no-repeat",width:e.selectedSpace["size_x"]+"px",height:e.selectedSpace["size_y"]+"px"}},[s("div",{staticClass:"book__switch"},[s("label",{attrs:{for:"switch"}},[e._v("Режим гостя")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.clientMode,expression:"clientMode"}],attrs:{type:"checkbox",id:"switch"},domProps:{checked:Array.isArray(e.clientMode)?e._i(e.clientMode,null)>-1:e.clientMode},on:{change:function(t){var s=e.clientMode,a=t.target,i=!!a.checked;if(Array.isArray(s)){var n=null,r=e._i(s,n);a.checked?r<0&&(e.clientMode=s.concat([n])):r>-1&&(e.clientMode=s.slice(0,r).concat(s.slice(r+1)))}else e.clientMode=i}}})]),e._l(e.tablePresetObj["tables"],function(t,a){return s("div",{key:a,staticClass:"preset__table",class:{selected:e.showTableMenu===t.id,additional:t.additional,busy:"busy"===t.busy_now,draft:"draft"===t.busy_now,booked:t.reserves.length>0,expired:e.isExpired(t),group:e.isInActiveGroup(t.group)},style:{top:t["pivot"]["coord_y"]+"px",left:t["pivot"]["coord_x"]+"px",height:t.seats_count*e.tableScale+"px","min-height":"30px","background-image":"none",width:t.seats_count*e.tableScale+"px","min-width":"30px","margin-top":-t.seats_count*e.tableScale/2+"px","margin-left":-t.seats_count*e.tableScale/2+"px","box-shadow":"0 0 4px 4px "+e.getGroupColor(t.group)},attrs:{"data-background":t.image_url},on:{click:function(s){t.reserves.length?e.openTableMenu(t):e.addReserve(t)}}},[t.reserves.length?s("div",{staticClass:"preset__table-reserve-options"},e._l(e.getOptionsArr(t.reserves[0].options),function(t,a){return s("span",{key:a,staticClass:"option",class:t.class},[e._v(e._s(t.value))])}),0):e._e(),s("div",{staticClass:"table-content"},[s("div",{staticClass:"text-wrapper"},[s("div",{staticClass:"text"},[s("div",{staticClass:"name"},[e._v(e._s(t.name))]),s("div",{staticClass:"seats"},[e._v("(Мест: "+e._s(t.seats_count)+")")]),e._l(t.reserves,function(a,i){return s("div",{key:i,staticClass:"preset__table-reserve",style:{height:100/t.reserves.length+"%",width:"80%"}},[s("div",{staticClass:"preset__table-reserve-text"},[s("span",[e._v(e._s(a.persons_count)+" чел. ")]),s("span",[e._v(e._s(e.moment(a.date_start).format("HH:mm"))+" - "+e._s(e.moment(a.date_finish).format("HH:mm"))+" ")]),s("span",[e._v(e._s(a.client.name)+" "+e._s(a.client.last_name))])])])})],2)])])])}),s("div",{directives:[{name:"show",rawName:"v-show",value:e.showTableMenu===e.tableToShow.id,expression:"showTableMenu === tableToShow.id"}],staticClass:"booking-menu-wrapper",on:{click:function(t){if(t.stopPropagation(),t.target!==t.currentTarget)return null;e.showTableMenu=null}}},[s("div",{staticClass:"booking-menu",on:{click:function(t){if(t.stopPropagation(),t.target!==t.currentTarget)return null;e.showTableMenu=null}}},[s("div",{staticClass:"booking-menu__body"},[s("h4",[e._v("Стол: "+e._s(e.tableToShow.name))]),s("h6",[e._v("(на "+e._s(e.tableToShow.seats_count)+" человек)")]),e.tableToShow.busy_now?e._e():s("button",{staticClass:"btn btn_pale",on:{click:function(t){return e.takeTable(e.tableToShow)}}},[e._v("Занять стол")]),"busy"===e.tableToShow.busy_now?s("button",{staticClass:"btn btn_pale",on:{click:function(t){return e.freeTable(e.tableToShow)}}},[e._v("Освободить стол")]):e._e(),"draft"===e.tableToShow.busy_now?s("button",{staticClass:"btn btn_pale",attrs:{disabled:!0}},[e._v("Стол в процессе букинга")]):e._e(),e._m(0),e._l(e.tableToShow.reserves,function(t,a){return s("div",{key:a,staticClass:"reserve"},[s("p",[e._v(e._s(t.client.name+t.client.last_name))]),s("p",[e._v(e._s(t.client.phone))]),s("p",[e._v(e._s(t.persons_count)+" чел.")]),s("p",[e._v("Статус: "+e._s(t.status))]),t.prepayment?s("p",[e._v("Предоплата: "+e._s(t.prepayment))]):e._e(),s("p",[e._v("С: "+e._s(t.date_start.slice(10,t.date_start.length-3)))]),s("p",[e._v("До: "+e._s(t.date_finish.slice(10,t.date_finish.length-3)))]),s("p",[e._v("Комментарий: "+e._s(t.comment))]),s("button",{staticClass:"btn btn_primary",attrs:{disabled:!!e.tableToShow.busy_now},on:{click:function(s){return e.editReserve(t)}}},[e._v("Редактировать резерв")]),s("button",{staticClass:"btn btn_danger",attrs:{disabled:!!e.tableToShow.busy_now},on:{click:function(s){return e.deleteReserve(t)}}},[e._v("Удалить резерв")])])}),0===e.tableToShow.reserves.length?s("p",[e._v("[нет резервов]")]):e._e(),s("button",{staticClass:"btn btn_success",attrs:{disabled:!!e.tableToShow.busy_now},on:{click:function(t){return e.addReserve(e.tableToShow)}}},[e._v("Добавить резерв")])],2)])])],2)]):e._e(),e.reserveToEdit||e.reserveToAdd?s("div",{staticClass:"modal",class:{fade:!e.reserveToEdit&&!e.reserveToAdd,open:e.reserveToEdit||e.reserveToAdd},on:{click:function(t){return t.target!==t.currentTarget?null:(t.stopPropagation(),e.closeReserveForm(e.reserveToAdd||e.reserveToEdit))}}},[s("div",{staticClass:"modal-dialog modal-lg"},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-body"},[s("div",{staticClass:"popup__close",on:{click:function(t){return e.closeReserveForm(e.reserveToAdd||e.reserveToEdit)}}},[e._v("×")]),s("reserve-form",{attrs:{type:e.reserveToAdd?"create":"edit",mode:"booking",reserve:e.reserveToAdd?e.reserveToAdd:e.reserveToEdit},on:{itemSubmitSuccess:e.onReserveSubmitSuccess}})],1)])])]):e._e(),e.reserveToDelete?s("div",{staticClass:"modal",class:{fade:!e.showReserveDeleteConfirmation,open:e.showReserveDeleteConfirmation},on:{click:function(t){if(t.target!==t.currentTarget)return null;t.stopPropagation(),e.showReserveDeleteConfirmation=!1}}},[s("div",{staticClass:"modal-dialog modal-md"},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-body"},[s("div",{staticClass:"popup__close",on:{click:function(t){e.showReserveDeleteConfirmation=!1}}},[e._v("×")]),s("h4",[e._v("Удалить резерв "+e._s(e.reserveToDelete.id)+"?")]),s("div",{staticClass:"popup__buttons popup__buttons_spread popup__buttons_mt"},[s("button",{staticClass:"btn btn_primary",on:{click:function(t){t.preventDefault(),e.showReserveDeleteConfirmation=!1}}},[e._v("Отмена")]),s("button",{staticClass:"btn btn_danger",on:{click:function(t){return t.preventDefault(),e.deleteConfirmed(e.reserveToDelete)}}},[e._v("Удалить")])])])])])]):e._e()])},Gt=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",{staticClass:"menu-section"},[s("b",[e._v("Резервы на сегодня:")])])}];function Zt(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,a)}return s}function Jt(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Zt(s,!0).forEach(function(t){Object(l["a"])(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Zt(s).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}var Kt=["#FF6633","#FF33FF","#00B3E6","#3366E6","#999966","#99FF99","#B34D4D","#CCCC00","#66E64D","#4D80CC","#9900B3","#E64D66"],es={name:"Booking",components:{Multiselect:K.a,Datepicker:ie.a,ReserveForm:De},mixins:[ne],data:function(){return{moment:Te.a,booking:{tablesForDate:{},tablePreset:{},events:[],reserves:[]},loaded:!1,date:Te()().format("YYYY-MM-DD"),selectedTable:{},selectedSpace:{},tablePresets:[],restaurantSpaces:[],comment:"",editComment:!1,tablePresetObj:{tablesForDate:{},tablePreset:{}},showTableList:!1,additionalTable:null,showTableMenu:null,tableToShow:{reserves:[]},reserveToEdit:null,reserveToDelete:null,showReserveDeleteConfirmation:!1,reserveToAdd:null,clientMode:!1,overbookReserves:[],changePreset:!0,bookingInterval:null}},computed:{tableScale:function(){return this.tablePresetObj&&this.tablePresetObj.scale?5*this.tablePresetObj.scale:5}},watch:{clientMode:function(e){$(".preset__table").each(function(t,s){$(s).css({"background-image":e?"url("+$(s).data("background"):"none","background-size":"100% 100%","background-repeat":"no-repeat","background-position":"center center"})})}},methods:{getTablePresets:function(){var e=this;this.$http.get(Q.tablePreset).then(function(t){e.selectedTable=t.data.data.items[0],e.tablePresets=t.data.data.items}).catch(function(t){e.handleFormValidationErrors(t,e.$refs.form)})},getRestaurantSpaces:function(){var e=this;return this.$http.get(Q.restaurantSpace).then(function(t){e.selectedSpace=t.data.data.items[0],e.restaurantSpaces=t.data.data.items}).catch(function(t){e.handleFormValidationErrors(t,e.$refs.form)})},getBooking:function(){var e=this;return this.$http.get(Q.booking+"/"+this.selectedSpace.id+"/"+this.date).then(function(t){e.booking=t.data.data,e.tablePresetObj=e.booking["tablePreset"],e.overbookReserves=e.booking.overbookReserves,e.booking.tablesForDate||(e.booking.tablesForDate={additional_tables:[]}),e.tablePresetObj.tables=e.tablePresetObj.tables.concat(e.booking.tablesForDate.additional_tables).map(function(e){return Object.assign(e,{reserves:[]})}),e.booking.reserves.forEach(function(t,s){t.tables.forEach(function(a){var i=e.tablePresetObj.tables.find(function(e){return e.id===a.id});i.reserves=i.reserves?i.reserves:[],i.reserves.push(t),i.group={index:s,start:t.date_start,finish:t.date_finish}})}),e.loaded=!0}).catch(function(t){e.handleFormValidationErrors(t,e.$refs.form)})},tryEditComment:function(){this.editComment=!0},openTableMenu:function(e){this.tableToShow=e,this.showTableMenu=e.id},editReserve:function(e){e.table_id=this.showTableMenu,this.startDraft(this.tableToShow),this.showTableMenu=null,this.reserveToEdit=Jt({table:this.tableToShow,table_id:this.tableToShow.id},e)},addReserve:function(e){this.startDraft(e),this.reserveToAdd={new:!0,tables:[e],date_start:this.date+" 00:00:00",date_finish:this.date+" 00:00:00"}},onReserveSubmitSuccess:function(e){this.closeReserveForm(e),this.getBooking()},closeReserveForm:function(e){this.reserveToEdit=null,this.reserveToAdd=null,this.freeTable(e.tables)},deleteReserve:function(e){this.reserveToDelete=e,this.showReserveDeleteConfirmation=!0},deleteConfirmed:function(e){var t=this;this.$http.delete(Q.reserve+"/"+e.id).then(function(e){t.showReserveDeleteConfirmation=!1,e.data&&!0===e.data.success&&t.getBooking().then(function(){t.tableToShow=t.tablePresetObj.tables.find(function(e){return e.id===t.tableToShow.id})})}).catch(function(e){return console.log(e)})},takeTable:function(e){var t=this,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&("number"===typeof e.id?(e.busy_now="busy",this.$http.post("tables/"+e.id,e).then(function(){s&&t.getBooking().then(function(){t.tableToShow=t.tablePresetObj.tables.find(function(e){return e.id===t.tableToShow.id})})})):e.length&&(e[0].busy_now="busy",this.$http.post("tables/"+e[0].id,e[0]).then(function(){s&&t.getBooking().then(function(){t.tableToShow=t.tablePresetObj.tables.find(function(e){return e.id===t.tableToShow.id})})})))},startDraft:function(e){var t=this,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&("number"===typeof e.id?(e.busy_now="draft",this.$http.post("tables/"+e.id,e).then(function(){s&&t.getBooking().then(function(){t.tableToShow=t.tablePresetObj.tables.find(function(e){return e.id===t.tableToShow.id})})})):e.length&&(e[0].busy_now="draft",this.$http.post("tables/"+e[0].id,e[0]).then(function(){s&&t.getBooking().then(function(){t.tableToShow=t.tablePresetObj.tables.find(function(e){return e.id===t.tableToShow.id})})})))},freeTable:function(e){var t=this,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&("number"===typeof e.id?(e.busy_now="",this.$http.post("tables/"+e.id,e).then(function(){s&&t.getBooking().then(function(){t.tableToShow=t.tablePresetObj.tables.find(function(e){return e.id===t.tableToShow.id})})})):e.length&&(e[0].busy_now="",this.$http.post("tables/"+e[0].id,e[0]).then(function(){s&&t.getBooking().then(function(){t.tableToShow=t.tablePresetObj.tables.find(function(e){return e.id===t.tableToShow.id})})})))},getOptionsArr:function(e){return e&&e.length?e.split(", ").map(function(e){var t={};switch(e){case"ПО":t.class="po";break;case"ПС":t.class="ps";break;case"ПЗ":t.class="pz";break;default:break}return t.value=e,t}):[]},isExpired:function(e){return e.reserves&&e.reserves.length&&(new Date).getTime()>new Date(e.reserves[0].date_start).getTime()},isInActiveGroup:function(e){return!!e&&Te()(new Date).isBetween(Te()(e.start),Te()(e.finish))},getGroupColor:function(e){return e&&e.hasOwnProperty("index")&&"number"===typeof e.index?Kt[e.index]:"transparent"},editTablePresetForDate:function(e){var t=this,s=e.goToForm,a=void 0!==s&&s;this.editComment=!1,this.booking.tablesForDate.id?this.$http.put(Q.tablesForDate+"/"+this.booking.tablesForDate.id,{day_description:this.booking.tablesForDate.day_description,date:this.booking.tablesForDate.date,table_preset_id:this.booking.tablesForDate.table_preset_id,restaurant_space_id:this.booking.tablesForDate.restaurant_space_id}).then(function(){t.getBooking(),a&&t.$store.dispatch("setItemToEdit",{id:t.booking.tablesForDate.id,type:"tablesForDate"}).then(function(){t.$router.push("/table-presets/on-date")})}):this.$http.post(Q.tablesForDate,{day_description:this.booking.tablePreset.day_description,table_preset_id:this.booking.tablePreset.id,date:this.date,restaurant_space_id:this.booking.tablePreset.restaurant_space_id}).then(function(){t.getBooking(),a&&t.$store.dispatch("setItemToEdit",{id:"last",type:"tablesForDate"}).then(function(){t.$router.push("/table-presets/on-date")})})}},mounted:function(){var e=this;this.getRestaurantSpaces().then(function(){e.getBooking()}),this.getTablePresets(),this.bookingInterval=setInterval(this.getBooking,6e4)},beforeDestroy:function(){clearInterval(this.bookingInterval)}},ts=es,ss=Object(v["a"])(ts,Wt,Gt,!1,null,null,null),as=ss.exports,is=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"section reserves"},[s("h2",{staticClass:"section__title"},[e._v("Резервы")]),s("data-table",{ref:"table",attrs:{options:e.tableOptions}})],1)},ns=[],rs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.data.tables&&e.data.tables.length?s("span",e._l(e.data.tables,function(t,a){return s("span",{key:a},[e._v(" "+e._s(t.name)+" ")])}),0):e._e()},os=[],ls={name:"tables",props:["data","index"]},cs=ls,us=Object(v["a"])(cs,rs,os,!1,null,null,null),ds=us.exports,ms=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",[e.data.event?s("a",{staticStyle:{color:"#333"},attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.show(t)}}},[e._v(" "+e._s(e.data.event.title)+" ")]):s("span",[e._v("(Не задано)")])])},ps=[],bs={name:"event",props:["data","index"],methods:{show:function(){this.$parent.$parent.$emit("showItem",this.data.event)}}},hs=bs,vs=Object(v["a"])(hs,ms,ps,!1,null,null,null),_s=vs.exports,fs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",[s("a",{staticStyle:{color:"#333"},attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.show(t)}}},[e._v(" "+e._s(e.data.client.name))])])},gs=[],js={name:"client",props:["data","index"],methods:{show:function(){this.$parent.$parent.$emit("showItem",this.data.client)}}},Cs=js,Os=Object(v["a"])(Cs,fs,gs,!1,null,null,null),ys=Os.exports,ws={name:"Reserves",components:{DataTable:lt},data:function(){return{tableOptions:{type:"reserve",getDataParams:{orderBy:"created_at",sortedBy:"desc"},columns:["id","event_name","table_name","client_name","persons_count","date_start","created_at","options","edit"],filterable:["event_name","table_name","client_name","persons_count","date_start"],searchParams:["event_name","client_name","table_name"],headings:{id:"#",event_name:"Название события",client_name:"Имя клиента",table_name:"Стол(ы)",persons_count:"Количество человек",date_start:"Дата начала",date_finish:"Дата окончания",options:"Статус",edit:"Действия",prepayment:"Предоплата",comment:"Комментарий",avg_check:"Средний чек",name:"Имя клиента",last_name:"Фамилия клиента",email:"email",phone:"Телефон",created_at:"Создан",updated_at:"Обновлен",image_url:"Изображение",title:"Название",date_time:"Дата",description:"Описание",ticket_price:"Цена билета",min_deposit:"Минимальный депозит"},templates:{event_name:_s,client_name:ys,table_name:ds},prefetchDataList:[],actions:["view","edit","delete","copy"]}}},methods:{}},Ts=ws,ks=Object(v["a"])(Ts,is,ns,!1,null,null,null),Ss=ks.exports,xs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"section reserves-from-app"},[s("h2",{staticClass:"section__title"},[e._v("Резервы из приложения")]),s("data-table",{ref:"table",attrs:{options:e.tableOptions}})],1)},Ps=[],Ds={name:"ReservesFromApp",components:{DataTable:lt},data:function(){return{tableOptions:{type:"reserveFromApp",getDataParams:{orderBy:"created_at",sortedBy:"desc",from_mobile:!0},columns:["id","event_name","table_name","client_name","persons_count","date_start","created_at","options","edit"],filterable:["event_name","table_name","client_name","persons_count","date_start"],searchParams:["event_name","client_name","table_name"],headings:{id:"#",event_name:"Название события",client_name:"Имя клиента",table_name:"Стол(ы)",persons_count:"Количество человек",date_start:"Дата начала",date_finish:"Дата окончания",options:"Статус",edit:"Действия",prepayment:"Предоплата",comment:"Комментарий",avg_check:"Средний чек",name:"Имя клиента",last_name:"Фамилия клиента",email:"email",phone:"Телефон",created_at:"Создан",updated_at:"Обновлен",image_url:"Изображение",title:"Название",date_time:"Дата",description:"Описание",ticket_price:"Цена билета",min_deposit:"Минимальный депозит"},templates:{event_name:_s,client_name:ys,table_name:ds},prefetchDataList:[],actions:["view","edit"]}}},methods:{}},$s=Ds,Ms=Object(v["a"])($s,xs,Ps,!1,null,null,null),Es=Ms.exports,Fs=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},Is=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"error"},[s("div",{staticClass:"error__content"},[s("img",{staticClass:"error__image",attrs:{src:"/img/account/x.svg",alt:""}}),s("div",{staticClass:"error__text"},[s("div",{staticClass:"error__code"},[e._v("404")]),s("div",{staticClass:"error__message"},[e._v("Страница не найдена")])])])])}],Rs={name:"NotFound"},Ls=Rs,As=Object(v["a"])(Ls,Fs,Is,!1,null,null,null),Ys=As.exports,Ns=[{path:"/login",name:"Login",component:R,meta:{guest:!0}},{path:"/",name:"Main",component:H,meta:{requiresAuth:!0}},{path:"/table-presets",redirect:"/table-presets/saved"},{path:"/table-presets/saved",name:"TablePresetsSaved",component:mt,meta:{requiresAuth:!0}},{path:"/table-presets/on-date",name:"TablePresetsForDate",component:ft,meta:{requiresAuth:!0}},{path:"/table-presets/create",name:"TablePresetCreate",component:wt,meta:{requiresAuth:!0}},{path:"/tables",name:"Tables",component:Ht,meta:{requiresAuth:!0}},{path:"/tables/create",name:"TableCreate",component:Qt,meta:{requiresAuth:!0}},{path:"/events",name:"Events",component:Dt,meta:{requiresAuth:!0}},{path:"/events/create",name:"EventCreate",component:Rt,meta:{requiresAuth:!0}},{path:"/booking",name:"Booking",component:as,meta:{requiresAuth:!0}},{path:"/reserves",name:"Reserves",component:Ss,meta:{requiresAuth:!0}},{path:"/reserves-from-app",name:"ReservesFromApp",component:Es,meta:{requiresAuth:!0}},{path:"*",component:Ys}];a["default"].use(P["a"]);var Bs=new P["a"]({mode:"history",routes:Ns}),Hs=Bs,Us=function(){return{user:JSON.parse(localStorage.getItem(W.user.local))||{},status:localStorage.getItem(W.token.local)?"auth":"",token:localStorage.getItem(W.token.local)||"",TABLE_TYPES:null,FLOOR_LIST:null,TABLE_LIST:null,TABLE_STATUS_LIST:null,USER_STATUS_LIST:null,USER_ROLES_LIST:null,FUTURE_EVENT_LIST:null,RESERVE_STATUS_LIST:null,CURRENCY_LIST:null,sidebarMinimized:JSON.parse(localStorage.getItem(W.sidebarMinimized.local))||!1,itemToEditId:null,reservesFromAppCounter:0}},zs={isLoggedIn:function(e){return!!e.token},getDataListItemByKey:function(e){return function(t,s,a){return e[t]&&e[t][s]?a&&Array===a.constructor?a.map(function(a){return e[t][s][a]}).join(", "):e[t][s][a]:a}},reservesFromAppCounter:function(e){return e.reservesFromAppCounter>99?"99+":e.reservesFromAppCounter}},qs=s("7618"),Vs={auth_request:function(e){e.status="loading"},auth_success:function(e,t){var s=t.token,a=t.user;e.status="auth",e.token=s,e.user=a},auth_error:function(e){e.status="error"},logout:function(e){e.status="",e.token="",e.user={}},dataList:function(e,t){var s=t.key,a=t.value;e[s]=a},toggleSidebar:function(e){e.sidebarMinimized=!e.sidebarMinimized},itemToEdit:function(e,t){e.itemToEdit=t},reservesFromApp:function(e,t){e.reservesFromAppCounter="object"===Object(qs["a"])(t)?t.length:0}},Xs=s("bc3a"),Qs=s.n(Xs),Ws=Qs.a.create();Ws.defaults.baseURL=Q.baseURL,localStorage.getItem(W.token.local)&&Ws.defaults.params&&(Ws.defaults.params[W.token.param]=localStorage.getItem(W.token.local));var Gs=Ws,Zs={login:function(e,t){var s=e.commit;return new Promise(function(e,a){s("auth_request");var i=t.rememberMe;Gs.defaults.params&&delete Gs.defaults.params[W.token.param],Gs.post(Q.login,t.user).then(function(t){if(console.log(t.data["success"]),t.data["success"]){var n=t.data.data["api_token"],r=t.data.data;Gs.defaults.params={},Gs.defaults.params[W.token.param]=n,console.log(r),console.log(Gs.defaults.params),i&&(localStorage.setItem(W.token.local,n),localStorage.setItem(W.user.local,JSON.stringify(r))),s("auth_success",{token:n,user:r}),e(t)}else s("auth_error"),a(t)}).catch(function(e){s("auth_error"),a(e)})})},logout:function(e){var t=e.commit;return new Promise(function(e){t("logout"),Gs.defaults.params=null,console.log("logout"),localStorage.removeItem(W.token.local),localStorage.removeItem(W.user.local),e()})},getDataList:function(e,t){var s=e.commit,a=e.state;return new Promise(function(e,i){a[t]?e(a[t]):Gs.get(Q.dataList[t]).then(function(a){a&&a.data&&a.data.data&&!0===a.data.success?(s("dataList",{key:t,value:a.data.data}),e(a.data.data)):i(a)}).catch(function(e){return i(e)})})},toggleSidebar:function(e){var t=e.commit,s=e.state;localStorage.setItem(W.sidebarMinimized.local,JSON.stringify(!s.sidebarMinimized)),t("toggleSidebar")},setItemToEdit:function(e,t){var s=e.commit;s("itemToEdit",t)},getReservesFromApp:function(e){var t=e.commit;return new Promise(function(e,s){Gs.get(Q.reserveFromApp,{params:{from_mobile:!0}}).then(function(a){a&&a.data&&a.data.data&&a.data.data.items&&!0===a.data.success?(t("reservesFromApp",a.data.data.items),e(a.data.data.items)):s(a)}).catch(function(e){return s(e)})})}};a["default"].use(c["a"]);var Js=function(){return new c["a"].Store({state:Us(),getters:zs,mutations:Vs,actions:Zs})},Ks=Js,ea={methods:{clearReadonly:function(e){e.target.removeAttribute("readonly")}}},ta={methods:{addWatcher:function(e){this[e+"Watcher"]=this.$watch(e,{handler:function(e){this.$emit("itemChanged",e)},deep:!0})}}},sa=s("9ebe");s("e607"),s("29d8");window.$=window.jQuery=s("1157"),Hs.beforeEach(function(e,t,s){if(e.matched.some(function(e){return e.meta.requiresAuth})){if(Ks().getters.isLoggedIn)return void s();s("/login")}else if(e.matched.some(function(e){return e.meta.guest})){if(!Ks().getters.isLoggedIn)return void s();s("/")}else s()}),Gs.interceptors.response.use(function(e){return e},function(e){return new Promise(function(t,s){e&&e.response&&401===e.response.status?Ks().dispatch("logout").then(function(){return Hs.go("/login")}):s(e)})}),a["default"].prototype.$http=Gs,a["default"].config.productionTip=!1,a["default"].mixin(ea),a["default"].mixin(ta),a["default"].use(sa["ClientTable"],{},!1,"bootstrap3","default"),new a["default"]({el:"#app",router:Hs,store:Ks,render:function(e){return e(x)}}).$mount("#app")},c62e:function(e,t,s){}});
//# sourceMappingURL=app.0bdf4766.js.map